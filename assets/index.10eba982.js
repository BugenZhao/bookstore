var e=Object.defineProperty,n=Object.defineProperties,t=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,i=(n,t,a)=>t in n?e(n,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[t]=a,o=(e,n)=>{for(var t in n||(n={}))r.call(n,t)&&i(e,t,n[t]);if(a)for(var t of a(n))s.call(n,t)&&i(e,t,n[t]);return e},l=(e,a)=>n(e,t(a));import{r as c,j as d,u as m,_ as u,a as h,N as p,b as v,C as f,L as g,c as b,B as N,d as y,e as w,O as x,T as S,F as k,f as C,g as P,h as O,R as A,i as I,I as $,k as E,M as T,l as j,m as L,n as B,t as D,o as F,S as M,p as U,A as q,q as H,s as K,v as R,G,w as J,x as Y,P as z,y as V,z as Z,D as W,E as _,H as Q,J as X,K as ee,Q as ne,U as te,V as ae,W as re,X as se,Y as ie,Z as oe,$ as le,a0 as ce,a1 as de,a2 as me,a3 as ue,a4 as he,a5 as pe,a6 as ve,a7 as fe,a8 as ge,a9 as be,aa as Ne}from"./vendor.bc6c7a8e.js";const ye=c.exports.createContext(void 0);function we(){return c.exports.useContext(ye)}function xe(e){const[n,t]=c.exports.useState(!1);return d(ye.Provider,{value:{signedOut:n,setSignedOut:t},children:e.children})}function Se(e,n){return m("/api"+e,(async e=>{const n=await fetch(e);if(!n.ok)throw n;return n.json()}),n)}const ke={"Content-type":"application/json; charset=UTF-8"};function Ce(e,n){return fetch("/api"+e,{method:"POST",body:n,headers:ke})}function Pe(e,n){return fetch("/api"+e,{method:"PUT",body:n,headers:ke})}function Oe(e,n){return fetch("/api"+e,{method:"DELETE",body:n,headers:ke})}function Ae(e,n){return fetch("/api"+e,{method:"PATCH",body:n,headers:ke})}var Ie,$e;function Ee(){const e=Se("/users/check"),n=e.data&&!e.error?e.data.user_type===Ie.admin:void 0;return o({isAdmin:n},e)}function Te(){var e,n,t,a,r,s;const i=Se("/cart/"),l=i.data&&!i.error?u(i.data.books).map((e=>e.count)).sum():0;return o({books:null!=(n=i.error||null==(e=i.data)?void 0:e.books)?n:[],discount:null!=(a=i.error||null==(t=i.data)?void 0:t.discount)?a:0,total:null!=(s=i.error||null==(r=i.data)?void 0:r.total)?s:0,cartCount:l},i)}function je({active:e}){var n,t;const{cartCount:a}=Te(),r=null!=(n=Ee().isAdmin)&&n,s=null!=(t=h().params.keyword)?t:"";return d(p,{bg:"white",expand:"lg",className:"shadow-sm fixed-top",children:v(f,{children:[d(p.Brand,{className:"fw-bolder",as:g,to:"/home",children:"Book Store"}),d(p.Toggle,{"aria-controls":"basic-navbar-nav"}),v(p.Collapse,{id:"basic-navbar-nav",children:[v(b,{className:"me-auto",children:[d(b.Link,{as:g,to:"/home",active:"home"===e||"detail"===e||"search"===e,children:"Books"}),d(b.Link,{as:g,to:"/checkout",active:"cart"===e,children:v("div",{className:"d-flex align-items-center",children:[d("span",{className:"me-1",children:"My Cart"}),d(N,{children:d(y,{bg:0===a?"secondary":"danger",pill:!0,children:a})})]})}),d(b.Link,{as:g,to:"/orders",active:"orders"===e,children:"My Orders"}),d(Le,{})]}),d(Be,{initial:s}),r?d(De,{active:e}):null]})]})})}function Le(){var e;const{setSignedOut:n}=we(),t=w(),{data:a,revalidate:r}=Ee();return d(x,{overlay:d(S,{id:"signout-tooltip",children:"Click to sign out"}),placement:"auto",children:v(b.Link,{onClick:async()=>{await Ce("/users/logout"),await r(),n(!0),t.push("/login")},children:[d("span",{children:"Hi, "}),d("span",{className:"fw-bold",children:null!=(e=null==a?void 0:a.username)?e:"???"})]})})}function Be({initial:e=""}){const n=c.exports.useRef(null),t=w();return v(k,{className:"d-flex mb-2 mb-lg-0",onSubmit:()=>{const e=n.current.value;e.length>0&&t.push(`/search/${e}`)},children:[d(C,{className:"form-control me-2",type:"search",placeholder:"Search Books...",defaultValue:e,ref:n}),d(P,{variant:"outline-secondary",type:"submit",children:"Search"})]})}function De({active:e}){return d("div",{className:"ms-lg-2 d-flex",children:d(P,"dashboard"===e?{as:g,to:"/home",variant:"success",className:"w-100",children:"Book Store"}:{as:g,to:"/dashboard",variant:"primary",className:"w-100",children:"Dashboard"})})}function Fe({py:e=4,children:n}){return d("main",{className:`py-${e} container`,children:n})}function Me(e){return d("div",{className:"store-home",children:e.children})}function Ue({book:e,count:n}){const t=`/detail/${e.id}`,{revalidate:a}=Te();return d(O.Item,{as:g,to:t,style:{color:"inherit",textDecoration:"inherit"},action:!0,children:v(A,{className:"d-flex justify-content-between",children:[d(I,{xs:3,children:d($,{src:e.image,fluid:!0})}),v(I,{className:"d-flex align-items-center",children:[v("div",{className:"me-auto",children:[d("h6",{className:"mb-0",children:e.name}),d("small",{className:"text-muted",children:e.author})]}),v("div",{className:"me-3",children:[v("span",{className:"h5",children:["¥",e.price]}),n>1?v("span",{className:"text-muted",children:[" x",n]}):null]}),d(y,{pill:!0,as:P,variant:"danger",onClick:async n=>{var t;n.preventDefault(),await(t=e.id.toString(),Oe(`/cart/${t}`)),await a()},children:"—"})]})]})})}function qe({title:e,value:n}){const t="Discount"===e?"text-danger":"fw-bold",a="Discount"===e?"-¥":"¥";return d(O.Item,{children:v("div",{className:"d-flex justify-content-between align-items-center",children:[d("div",{children:d("span",{className:"h6",children:e})}),d("div",{children:v("span",{className:`h5 ${t}`,children:[a,n.toFixed(2)]})})]})})}function He(){const{books:e,cartCount:n,discount:t,total:a,revalidate:r}=Te(),s=u(e).map((e=>d(Ue,{book:e.book,count:e.count},e.book.id))).value();return v("div",{children:[v("h4",{className:"d-flex align-items-center mb-3",children:[d("span",{className:"text-muted me-2",children:"My cart"}),d(y,{pill:!0,bg:"secondary",className:"me-auto",children:n}),n>0?d(y,{pill:!0,as:P,variant:"danger",onClick:async()=>{await Oe("/cart/"),await r()},children:"Clear"}):null]}),v("ul",{className:"list-group mb-3",children:[s,d(qe,{title:"Discount",value:t}),d(qe,{title:"Total",value:a})]})]})}($e=Ie||(Ie={})).admin="admin",$e.normal="normal";const Ke=c.exports.createContext(null);function Re({name:e,children:n}){const{selected:t,setSelected:a}=c.exports.useContext(Ke);return d("button",{onClick:()=>a(e),className:"list-group-item list-group-item-action "+(t===e?"active":""),children:v("div",{className:"d-flex w-100 justify-content-between align-items-center",children:[d("span",{children:e}),n]})})}function Ge(){return d("div",{className:"col",children:v("div",{className:"row gy-2",children:[v("div",{className:"col-md-6",children:[d("label",{htmlFor:"cc-name",className:"form-label",children:"Name on card"}),d("input",{type:"text",className:"form-control",id:"cc-name",placeholder:"",required:!0})]}),v("div",{className:"col-md-6",children:[d("label",{htmlFor:"cc-number",className:"form-label",children:"Card number"}),d("input",{type:"text",className:"form-control",id:"cc-number",placeholder:"",required:!0})]}),v("div",{className:"col-md-6",children:[d("label",{htmlFor:"cc-expiration",className:"form-label",children:"Expiration"}),d("input",{type:"text",className:"form-control",id:"cc-expiration",placeholder:"",required:!0})]}),v("div",{className:"col-md-6",children:[d("label",{htmlFor:"cc-cvv",className:"form-label",children:"CVV"}),d("input",{type:"text",className:"form-control",id:"cc-cvv",placeholder:"",required:!0})]})]})})}function Je(){const[e,n]=c.exports.useState("Credit card");return d(Ke.Provider,{value:{selected:e,setSelected:n},children:v("div",{children:[d("h4",{className:"mb-3",children:"Payment"}),v("div",{className:"row gy-2",children:[d("div",{className:"col-lg-5 col-xxl-4",children:v("div",{className:"list-group",children:[d(Re,{name:"PayPal"}),d(Re,{name:"WeChat Pay",children:d("span",{className:"badge bg-success rounded-pill",children:"Recommended"})}),d(Re,{name:"Alipay"}),d(Re,{name:"Credit card",children:d("span",{className:"badge bg-secondary rounded-pill",children:"Last used"})})]})}),"Credit card"===e?d(Ge,{}):v("div",{className:"col",children:["You'll be redirected to ",e,' after clicking "Checkout".']})]})]})})}const Ye=c.exports.createContext(void 0);function ze({address:e}){var n;const t="Default"===e.tag?"bg-secondary":"bg-success",{selected:a,setSelected:r}=c.exports.useContext(Ye);return v("button",{onClick:()=>r(e),className:"list-group-item list-group-item-action "+((null!=(n=null==a?void 0:a.id)?n:0)===e.id?"active":""),children:[v("div",{className:"d-flex w-100 justify-content-between align-items-center",children:[d("h5",{className:"mb-1",children:e.name}),d("span",{className:`badge ${t} rounded-pill`,children:e.tag})]}),d("p",{className:"mb-0 small",children:e.phone}),d("p",{className:"mb-0",children:e.address})]})}function Ve(){const{modalShow:e,setModalShow:n}=c.exports.useContext(Ye),{register:t,handleSubmit:a}=E();return v(T,{show:e,size:"lg",onHide:()=>n(!1),backdrop:"static",centered:!0,children:[d(T.Header,{closeButton:!0,children:d(T.Title,{children:"Add a New Address"})}),d(T.Body,{children:v(k,{onSubmit:a((e=>{alert(JSON.stringify(e)),n(!1)})),id:"add-new-address-form",children:[v(k.Group,{as:A,className:"mb-3",children:[d(k.Label,{column:!0,sm:3,children:"Name"}),d(I,{sm:9,children:d(k.Control,o({placeholder:"Enter full name",required:!0},t("name")))})]}),v(k.Group,{as:A,className:"mb-3",children:[d(k.Label,{column:!0,sm:3,children:"Phone Number"}),d(I,{sm:9,children:d(k.Control,o({placeholder:"Enter phone number",required:!0},t("phone")))})]}),v(k.Group,{as:A,className:"mb-3",children:[d(k.Label,{column:!0,sm:3,children:"Address"}),d(I,{sm:9,children:d(k.Control,o({as:"textarea",placeholder:"Enter address",required:!0},t("address")))})]}),d(k.Group,{className:"mb-3",children:d(k.Check,{type:"checkbox",label:"Set as default",id:"set-as-default"})})]})}),d(T.Footer,{children:d(P,{variant:"primary",type:"submit",form:"add-new-address-form",children:"Confirm"})})]})}function Ze(){const{setModalShow:e}=c.exports.useContext(Ye);return d(j,{children:d("button",{className:"list-group-item list-group-item-action",onClick:()=>e(!0),children:d("span",{className:"text-muted",children:"Add a new address..."})})})}function We(){const[e,n]=c.exports.useState(),[t,a]=c.exports.useState(!1);return d(Ye.Provider,{value:{selected:e,setSelected:n,modalShow:t,setModalShow:a},children:v("div",{children:[d("h4",{className:"mb-3",children:"Shipping Address"}),d("div",{children:v("div",{className:"list-group",children:[d(ze,{address:{id:0,name:"Bugen Zhao",tag:"Default",phone:"+86 155 2121 2121",address:"1234 Main St., Minhang, Shanghai, China"}}),d(ze,{address:{id:1,name:"Alice Cook",tag:"Home",phone:"+1 802 812 3456",address:"4321 Home St., Cupertino, CA, United States"}}),d(ze,{address:{id:2,name:"Dave Jobs",tag:"School",phone:"+86 188 1234 5678",address:"9876 School St., Shanghai, China"}}),d(Ze,{}),d(Ve,{})]})})]})})}function _e(){const{cartCount:e,revalidate:n}=Te(),[t,a]=c.exports.useState("no"),[r,s]=c.exports.useState(!1),i=0===e;return v("div",{children:[v(T,{show:"no"!==t,onHide:()=>{a("no"),s(!1)},children:[d(T.Header,{closeButton:!0,children:d(T.Title,{children:"success"===t?"Checkout Success":"Checkout Failed"})}),d(T.Body,{children:"success"===t?v(j,{children:["Go to ",d(g,{to:"/orders",children:"My Orders"})," to check the order."]}):"There is not enough stock of some books in your cart."})]}),v("div",{className:"row",children:[d("div",{className:"col-md-6 col-lg-5 order-md-last",children:d(He,{})}),v("div",{className:"col-md-6 col-lg-7",children:[d(We,{}),d("hr",{className:"my-4"}),d(Je,{}),d("hr",{className:"my-4"}),d("div",{className:"d-flex justify-content-end",children:d(x,{overlay:d(S,{id:"no-book-tooltip",children:"There's no book in the cart"}),placement:"bottom",show:i,children:d("button",{className:"btn btn-primary btn-lg col-12 col-lg-3",type:"submit",disabled:r||i,onClick:async()=>{s(!0);const e=await Ce("/cart/checkout");await n(),e.ok?a("success"):a("failed"),s(!1)},children:r?"Processing...":"Checkout"})})})]})]})]})}function Qe(){return v(Me,{children:[d(je,{active:"cart"}),d(Fe,{py:5,children:d(L,{children:d(_e,{})})})]})}function Xe({book:e,withLink:n=!0}){const t=`/detail/${e.id}`;return v(B,{children:[n?d(B.Link,{className:"stretched-link",as:g,to:t}):null,d(B.Img,{variant:"top",src:e.image}),v(B.Body,{children:[d(B.Title,{className:"text-truncate",children:e.name}),v("div",{className:"d-flex justify-content-between align-items-center",children:[v(B.Subtitle,{className:"text-danger",as:"h6",children:["¥",e.price]}),d(B.Subtitle,{className:"text-muted",as:"small",children:e.inventory})]})]})]})}function en({book:e}){const{revalidate:n}=Te();return v("div",{className:"d-flex flex-column justify-content-between",style:{height:"100%"},children:[v("div",{children:[d("h1",{className:"h2 my-3",children:e.name}),d("div",{className:"mb-3",children:v("dl",{className:"row",children:[d("dt",{className:"col-sm-3",children:"Author"}),d("dd",{className:"col-sm-9",children:e.author}),d("dt",{className:"col-sm-3",children:"Press"}),d("dd",{className:"col-sm-9",children:"Unknown Press"}),d("dt",{className:"col-sm-3",children:"ISBN"}),d("dd",{className:"col-sm-9",children:e.isbn}),d("dt",{className:"col-sm-3",children:"Category"}),d("dd",{className:"col-sm-9",children:e.type}),d("dt",{className:"col-sm-3",children:"Stock"}),d("dd",{className:D("col-sm-9",{"text-danger":0===e.inventory}),children:e.inventory}),d("dt",{className:"col-sm-3",children:"Price"}),v("dd",{className:"col-sm-9 text-danger fw-bold",children:["¥",e.price]}),d("dt",{className:"col-sm-3",children:"Introduction"}),d("dd",{className:"col-sm-9",children:e.description})]})})]}),d("div",{className:"my-3",children:d("div",{className:"d-flex justify-content-end",children:v(F,{className:"col-12 col-xl-6 col-lg-8",size:"lg",children:[d(P,{variant:"outline-danger",className:"w-100",disabled:0===e.inventory,onClick:async()=>{var t;await(t=e.id.toString(),Pe(`/cart/${t}`)),await n()},children:"Add to Cart"}),d(P,{variant:"outline-danger",className:"w-100",as:g,to:"/checkout",children:"Checkout"})]})})})]})}function nn(){const e=Se("/books/");return o({books:e.error?void 0:e.data},e)}function tn(e){const n=e.match.params.id;return v(Me,{children:[d(je,{active:"detail"}),d(Fe,{py:5,children:d(an,{id:n})})]})}function an({id:e}){const{book:n}=function(e){const n=Se(`/books/${e}`);return o({book:n.error?void 0:n.data},n)}(e);return v("div",n?{children:[d(rn,{name:n.name}),d(L,{children:v(A,{children:[d("div",{className:"col-md-5 col-lg-4 align-self-center",children:d(Xe,{book:n,withLink:!1})}),d("div",{className:"col-md-7 col-lg-8",children:d(en,{book:n})})]})})]}:{children:[d(rn,{}),d(A,{className:"justify-content-center mt-5",children:d(M,{animation:"border",variant:"primary"})})]})}function rn({name:e}){const n=w();return d("nav",{children:v("ol",{className:"breadcrumb h6",children:[d("li",{className:"breadcrumb-item",children:d(g,{to:"#",className:"",onClick:()=>n.goBack(),children:"⬅ Go Back"})}),d("li",e?{className:"breadcrumb-item active",children:e}:{className:"breadcrumb-item",children:"..."})]})})}function sn(){const e=function(){var e;const n=Se("/carousels/");return o({carousels:null!=(e=n.error?void 0:n.data)?e:[]},n)}().carousels.map((e=>function(e){return d(U.Item,{children:d("img",{className:"d-block w-100",src:e,alt:e})},e)}(e)));return d(L,{triggerOnce:!0,children:d(U,{className:"mb-4",fade:!0,children:e})})}function on(){const{total:e,page:n,setPage:t}=c.exports.useContext(cn),a=Math.ceil(e/12),r=u(u.range(1,a+1)).map((e=>d("li",{className:"page-item "+(e===n?"active":""),children:d("button",{className:"page-link",onClick:()=>t(e),children:e})},e))).value();return d("div",{className:"py-5",id:"footer",children:d("nav",{children:v("ul",{className:"pagination justify-content-center",children:[d("li",{className:"page-item "+(1===n?"disabled":""),children:d("button",{className:"page-link",onClick:()=>t(n-1),children:"Previous"})}),r,d("li",{className:"page-item "+(n===a?"disabled":""),children:d("button",{className:"page-link",onClick:()=>t(n+1),children:"Next"})})]})})})}function ln(){var e;const{setTotal:n,page:t}=c.exports.useContext(cn),a=null!=(e=h().params.keyword)?e:"",{books:r}=nn(),s=u(r).filter((e=>u(e).values().join().includes(a)));if(c.exports.useEffect((()=>n(s.size()))),!r)return d(A,{className:"justify-content-center mt-5",children:d(M,{animation:"border",variant:"primary"})});const i=s.map((e=>d("div",{className:"col",children:d(Xe,{book:e,withLink:!0})},`book${e.id}`))).drop(12*(t-1)).take(12).value();return d("div",{className:"row row-cols-2 row-cols-md-3 row-cols-lg-4 row-cols-xl-5 row-cols-xxl-6 g-3",id:"books",children:d(L,{cascade:!0,damping:.025,triggerOnce:!0,children:i})})}const cn=c.exports.createContext(null);function dn(){const[e,n]=c.exports.useState(0),[t,a]=c.exports.useState(1);return d(cn.Provider,{value:{total:e,setTotal:n,page:t,setPage:a},children:v("div",{children:[d(ln,{}),d(on,{})]})})}function mn(){return v(Me,{children:[d(je,{active:"home"}),d(Fe,{children:d(un,{})})]})}function un(){return v("div",{children:[d(sn,{}),d(dn,{})]})}function hn({isSignIn:e}){const n=e=>e?"Sign in":"Sign up",t=n(e),a=n(!e),r=e?"/register":"/login";return d(j,{children:v("h1",{className:"mb-3",children:[d("span",{className:"h1 fw-bold",children:t}),d("span",{className:"h4",children:" / "}),d(g,{className:"h5 fw-bold text-muted",to:r,children:a})]})})}function pn({isSignIn:e,children:n,onSubmit:t,isProcessing:a}){return d(j,{children:d("main",{className:"form-signin",children:v(L,{children:[d(hn,{isSignIn:e}),v("form",{onSubmit:t,children:[n,v(P,{className:"w-100 mt-3",variant:"dark",size:"lg",type:"submit",disabled:a,children:[a?"Signing ":"Sign ",e?"in":"up",a?"...":""]})]})]})})})}function vn(){const{signedOut:e,setSignedOut:n}=we(),{revalidate:t}=Ee(),a=w(),[r,s]=c.exports.useState(!1),[i,l]=c.exports.useState(!1),[m,u]=c.exports.useState(!1),{register:h,handleSubmit:p}=E({defaultValues:{username:"thunderboy",password:"reins1409"}});return c.exports.useEffect((()=>{const e=setTimeout((()=>{n(!1),s(!1)}),5e3);return()=>{clearTimeout(e),n(!1)}}),[n,r]),v(j,{children:[d(q,{show:e,variant:"primary",className:"text-center h5",children:"You have signed out."}),d(q,{show:r,variant:"danger",className:"text-center h5",children:"Your account has been banned by administrators."}),v(pn,{isSignIn:!0,onSubmit:p((async e=>{l(!0),u(!1);const r=await function(e){return Ce("/users/login",JSON.stringify(e))}(e);await t(),l(!1),r.ok?(n(!1),a.push("/home")):403===r.status?s(!0):u(!0)})),isProcessing:i,children:[d(x,{placement:"bottom-end",trigger:"focus",delay:300,overlay:d("div",{}),children:d(k.Control,o({className:"input-first",placeholder:"Username",autoComplete:"username",required:!0,autoFocus:!0,isInvalid:m},h("username")))}),d(k.Control,o({className:"input-last",placeholder:"Password",type:"password",required:!0,isInvalid:m},h("password"))),m?d(k.Control.Feedback,{type:"invalid",children:"Please try again."}):null,d(k.Switch,{className:"mt-3",label:"Remember me",defaultChecked:!0})]})]})}function fn(){return v(Me,{children:[d(je,{active:"search"}),d(Fe,{children:d(gn,{})})]})}function gn(){var e;const n=null!=(e=h().params.keyword)?e:"";return v("div",{children:[d("div",{className:"py-5",children:v("span",{className:"h1",children:['Search Results for "',n,'"']})}),d(dn,{})]})}function bn({modalShow:e,setModalShow:n,title:t="Error",children:a}){return v(T,{show:e,onHide:()=>n(!1),backdrop:"static",centered:!0,children:[d(T.Header,{closeButton:!0,children:d(T.Title,{children:t})}),d(T.Body,{children:a}),d(T.Footer,{children:d(P,{variant:"primary",onClick:()=>n(!1),children:"OK"})})]})}function Nn(e){return Object.entries(e).map((e=>e.map(encodeURIComponent).join("="))).join("&")}const yn=()=>H().subtract(H.duration(7,"days")),wn=()=>H();const xn=({direction:e})=>d("asc"===e?K:R,{}),Sn=({onSort:e,children:n,direction:t})=>v(P,{variant:"light",onClick:()=>e({}),children:[d("span",{className:"fw-bold",children:n}),t&&d(xn,{direction:t})]});function kn({rows:e,cols:n,onCommitChanges:t,booleanCols:a,disableEditingCols:r=["id"],showAddCommand:s=!1,showEditCommand:i=!1,showDeleteCommand:o=!1}){const l=c.exports.useRef(r.map((e=>({columnName:e,editingEnabled:!1}))));return d("div",{className:"card",children:v(G,{rows:e,columns:n,getRowId:e=>e.id,children:[d(J,{}),d(Y,{}),d(z,{defaultCurrentPage:0,pageSize:50}),d(V,{}),d(Z,{defaultSorting:[{columnName:"id",direction:"asc"}]}),d(W,{}),d(On,{for:null!=a?a:[]}),d(_,{onCommitChanges:t,columnExtensions:l.current}),d(Q,{}),d(X,{showSortingControls:!0,sortLabelComponent:Sn}),d(ee,{}),d(ne,{showAddCommand:s,showEditCommand:i,showDeleteCommand:o}),d(te,{}),d(ae,{}),d(re,{})]})})}const Cn=({value:e})=>d(k.Check,{type:"checkbox",checked:e,disabled:!0}),Pn=({value:e,onValueChange:n})=>d(k.Check,{type:"checkbox",defaultChecked:e,onChange:e=>n(e.target.checked)}),On=({for:e})=>d(se,{formatterComponent:Cn,editorComponent:Pn,for:e});function An(){const{books:e,revalidate:n}=nn(),t=Te().revalidate,a=u.values(e),r=["id","isbn","name","type","author","price","description","inventory","image"].map((e=>({name:e,title:ie(e)}))),[s,i]=c.exports.useState(!1),[o,l]=c.exports.useState();return v(j,{children:[d(bn,{modalShow:s,setModalShow:i,children:o?v(j,{children:[d("h5",{children:`Error occurred while processing "${o.url}":`}),d("p",{children:`${o.status} ${o.statusText}`})]}):null}),d(kn,{showAddCommand:!0,showDeleteCommand:!0,showEditCommand:!0,rows:a,cols:r,onCommitChanges:async({added:e,changed:a,deleted:r})=>{let s=[];if(e){const n=u(e).map((e=>{return n=e,Pe("/admin/books/",JSON.stringify(n));var n})).value();s.push(...n)}if(a){const e=u(a).entries().filter((([e,n])=>!!n)).map((([e,n])=>function(e,n){return Ae(`/admin/books/${e}`,JSON.stringify(n))}(e,n))).value();s.push(...e)}if(r){const e=u(r).map((e=>function(e){return Oe(`/admin/books/${e}`)}(e.toString()))).value();s.push(...e)}const o=(await Promise.all(s)).find((e=>!e.ok));l(o),i(!!o),await Promise.all([n(),t()])}})]})}function In(){const{users:e,revalidate:n}=function(){const e=Se("/admin/users/");return o({users:e.error?void 0:e.data},e)}(),t=u.values(e).map((e=>o({admin:e.type===Ie.admin},e))),[a,r]=c.exports.useState(!1),[s,i]=c.exports.useState();return v(j,{children:[d(bn,{modalShow:a,setModalShow:r,children:s?v(j,{children:[d("h5",{children:`Error occurred while processing "${s.url}":`}),d("p",{children:`${s.status} ${s.statusText}`})]}):null}),d(kn,{showEditCommand:!0,rows:t,cols:[{name:"id",title:"User ID"},{name:"username",title:"Username"},{name:"email",title:"Email"},{name:"admin",title:"Is Admin"},{name:"banned",title:"Is Banned"}],booleanCols:["admin","banned"],onCommitChanges:async({changed:e})=>{let t=[];if(e){const n=u(e).entries().filter((([e,n])=>!!n)).map((([e,n])=>function(e,n){return Ae(`/admin/users/${e}`,JSON.stringify(n))}(e,o({type:void 0!==n.admin?n.admin?Ie.admin:Ie.normal:void 0},n)))).value();t.push(...n)}const a=(await Promise.all(t)).find((e=>!e.ok));i(a),r(!!a),await n()}})]})}function $n({value:e}){const n=H(e);return d(j,{children:n.format("YYYY-MM-DD HH:mm:ss")})}function En({orders:e,showUser:n=!1}){const t=e.map((e=>{var n,t;return o({userShow:`${null==(n=e.user)?void 0:n.username} [${null==(t=e.user)?void 0:t.id}]`},e)})),a=[{name:"id",title:"Order ID"},{name:"createdAt",title:"Created At"},{name:"items",title:"Items"},{name:"totalPrice",title:"Total"},{name:"consignee",title:"Consignee"},{name:"status",title:"Status"}];n&&a.splice(1,0,{name:"userShow",title:"User"});const r=[{columnName:"createdAt",predicate:(e,n)=>{if(!n.value)return!0;const t=n.value.split(/,|~/).map((e=>e.trim())),a=H(e);return 1===t.length?a.isSameOrAfter(t[0]):a.isSameOrAfter(t[0])&&a.isBefore(t[1])}},{columnName:"items",predicate:(e,n)=>{if(!n.value)return!0;return e.map((e=>e.book.name)).filter((e=>e.indexOf(n.value)>=0)).length>0}}];return d("div",{className:"card",children:v(G,{rows:t,columns:a,getRowId:e=>e.id,children:[d(oe,{}),d(Y,{columnExtensions:r}),d(z,{defaultCurrentPage:0,pageSize:20}),d(V,{}),d(Z,{defaultSorting:[{columnName:"id",direction:"asc"}]}),d(W,{}),d(se,{formatterComponent:({value:e})=>{const n=e.map((({book:e,quantity:n})=>d(A,{children:v(g,{to:`/detail/${e.id}`,className:"d-flex nav-link",children:[d("span",{className:"me-auto",children:e.name}),v("span",{className:"text-muted",children:["x",n]})]})},e.id)));return d(j,{children:n})},for:["items"]}),d(se,{formatterComponent:$n,for:["createdAt"]}),d(Q,{}),d(le,{defaultColumnWidths:[{columnName:"id",width:120},{columnName:"userShow",width:150},{columnName:"createdAt",width:280},{columnName:"items",width:350},{columnName:"totalPrice",width:100},{columnName:"consignee",width:150},{columnName:"status",width:100}]}),d(X,{showSortingControls:!0,sortLabelComponent:Sn}),d(ce,{}),d(re,{})]})})}function Tn(){const{orders:e}=function(){var e;const n=Se("/admin/orders/");return o({orders:null!=(e=n.error?void 0:n.data)?e:[]},n)}();return d(En,{orders:e,showUser:!0})}var jn,Ln;function Bn({initial:e,onChange:n}){const[t,a]=c.exports.useState(e);return d(de,{selected:t.toDate(),onChange:e=>{a(H(null==e?void 0:e.toString())),n(H(null==e?void 0:e.toString()))},showTimeInput:!0,showTimeSelect:!0,dateFormat:"Pp"})}function Dn({onChange:e}){const n=c.exports.useRef(yn()),t=c.exports.useRef(wn()),a=()=>e({from:n.current,to:t.current});return c.exports.useEffect((()=>{a()})),v(k,{className:"mx-4 my-4",children:[v(k.Group,{as:A,className:"mb-2",controlId:"formFrom",children:[d(k.Label,{column:!0,md:"1",xs:"2",children:"From"}),d(I,{lg:"3",sm:"7",xs:"10",children:d(Bn,{initial:n.current,onChange:e=>{n.current=e,a()}})})]}),v(k.Group,{as:A,className:"mb-2",controlId:"formTo",children:[d(k.Label,{column:!0,md:"1",xs:"2",children:"To"}),d(I,{lg:"3",sm:"7",xs:"10",children:d(Bn,{initial:t.current,onChange:e=>{t.current=e,a()}})})]})]})}function Fn(){var e,n;const[t,a]=c.exports.useState(yn()),[r,s]=c.exports.useState(wn()),{sales:i}=function(e,n){const t=Se("/admin/stat/sales?"+Nn({from:null==e?void 0:e.toISOString(),to:null==n?void 0:n.toISOString()}));return o({sales:t.error?void 0:t.data},t)}(t,r),l=w(),m=null!=(e=null==i?void 0:i.map((({book:e})=>e)))?e:[],u=null!=(n=null==i?void 0:i.map((({count:e})=>e)))?n:[],h={title:{text:"Sales Summary"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"value"},yAxis:{type:"category",data:m.map((e=>e.name)).reverse()},series:[{type:"bar",data:u.reverse()}]};return v(j,{children:[d(Dn,{onChange:e=>{a(e.from),s(e.to)}}),d(me,{style:{height:60*m.length+80},option:h,onEvents:{click:e=>{const n=e.name,t=m.find((e=>e.name===n));t&&l.push(`/detail/${t.id}`)}}})]})}function Mn(){var e,n;const[t,a]=c.exports.useState(yn()),[r,s]=c.exports.useState(wn()),{userSpendings:i}=function(e,n){const t=Se("/admin/stat/spendings?"+Nn({from:null==e?void 0:e.toISOString(),to:null==n?void 0:n.toISOString()}));return o({userSpendings:t.error?void 0:t.data},t)}(t,r),l=null!=(e=null==i?void 0:i.map((e=>e.user)))?e:[],m=null!=(n=null==i?void 0:i.map((e=>e.spending)))?n:[],u={title:{text:"User Spendings Summary"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"value"},yAxis:{type:"category",data:l.map((e=>`${e.username} [${e.id}]`)).reverse()},series:[{type:"bar",data:m.reverse()}],responsive:!0};return v(j,{children:[d(Dn,{onChange:e=>{a(e.from),s(e.to)}}),d(me,{style:{height:60*l.length+80},option:u})]})}function Un(){return v(Me,{children:[d(je,{active:"dashboard"}),d(Fe,{children:d(qn,{})})]})}function qn(){var e;const n=null!=(e=h().params.tab)?e:"books",t=w();return v("div",{children:[d("div",{className:"h1 mb-4",children:"Dashboard"}),v(ue,{activeKey:n,onSelect:e=>{const n=null!=e?e:"books";t.replace(`/dashboard/${n}`)},className:"mb-3",children:[d(he,{eventKey:"books",title:"Books",children:d(An,{})}),d(he,{eventKey:"users",title:"Users",children:d(In,{})}),d(he,{eventKey:"orders",title:"Orders",children:d(Tn,{})}),d(he,{eventKey:"sales",title:"Sales",children:d(Fn,{})}),d(he,{eventKey:"spendings",title:"User Spendings",children:d(Mn,{})})]})]})}function Hn(){var e,n,t;const{setSignedOut:a}=we(),{revalidate:r}=Ee(),s=w(),[i,l]=c.exports.useState(!1),[m,u]=c.exports.useState(!1),{register:h,handleSubmit:p,watch:f,formState:{errors:g}}=E(),b=f("password");return d(j,{children:v(pn,{isSignIn:!1,onSubmit:p((async e=>{l(!0);const n=await function(e){return Ce("/users/register",JSON.stringify(e))}({username:e.username,email:e.email,password:e.password});await r(),l(!1),n.ok?(a(!1),s.push("/home")):u(!0)})),isProcessing:i,children:[d(k.Control,o({className:"input-first",placeholder:"Username",autoComplete:"username",required:!0,isInvalid:m},h("username"))),d(k.Control,o({className:"input-mid",placeholder:"Email",autoComplete:"email",required:!0,isInvalid:!!g.email},h("email",{pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Please provide a valid email address."}}))),d(k.Control.Feedback,{type:"invalid",children:null==(e=g.email)?void 0:e.message}),d(k.Control,o({className:"input-mid",placeholder:"Password",type:"password",autoComplete:"new-password",required:!0,isInvalid:!!g.password},h("password",{minLength:{value:4,message:"Password must have at least 4 characters."}}))),d(k.Control.Feedback,{type:"invalid",children:null==(n=g.password)?void 0:n.message}),d(k.Control,o({className:"input-last",placeholder:"Confirm Password",type:"password",autoComplete:"new-password",required:!0,isInvalid:!!g.confirmPassword},h("confirmPassword",{validate:e=>e===b||"The passwords do not match."}))),d(k.Control.Feedback,{type:"invalid",children:null==(t=g.confirmPassword)?void 0:t.message}),m?d(k.Control.Feedback,{type:"invalid",children:"Please try again."}):null,d(k.Check,{type:"checkbox",className:"mt-3",label:"Agree to terms and privacy policy",id:"accept-privacy-policy",defaultChecked:!0})]})})}function Kn(){var e,n;const[t,a]=c.exports.useState(yn()),[r,s]=c.exports.useState(wn()),{summary:i}=function(e,n){const t=Se("/stat/summary?"+Nn({from:null==e?void 0:e.toISOString(),to:null==n?void 0:n.toISOString()}));return o({summary:t.error?void 0:t.data},t)}(t,r),l=w(),m=null!=(e=null==i?void 0:i.books)?e:[],h={title:{text:`${u(m).map((({count:e})=>e)).sum()} books, ¥${null!=(n=null==i?void 0:i.total)?n:0} in total`},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"value"},yAxis:{type:"category",data:m.map((({book:e})=>e.name)).reverse()},series:[{type:"bar",data:m.map((({count:e})=>e)).reverse()}]};return v(j,{children:[d(Dn,{onChange:e=>{a(e.from),s(e.to)}}),d(me,{style:{height:60*m.length+80},option:h,onEvents:{click:e=>{var n;const t=e.name,a=null==(n=m.find((({book:e})=>e.name===t)))?void 0:n.book;a&&l.push(`/detail/${a.id}`)}}})]})}function Rn(){return v(Me,{children:[d(je,{active:"orders"}),d(Fe,{children:d(Gn,{})})]})}function Gn(){var e;const n=null!=(e=h().params.tab)?e:"all",t=w();return v(j,{children:[d("div",{className:"h1 mb-4",children:"My Orders"}),v(ue,{activeKey:n,onSelect:e=>{const n=null!=e?e:"books";t.replace(`/orders/${n}`)},className:"mb-3",children:[d(he,{eventKey:"all",title:"All Orders",children:d(Jn,{})}),d(he,{eventKey:"summary",title:"Summary",children:d(Kn,{})})]})]})}function Jn(){const{orders:e}=function(){var e;const n=Se("/orders/");return o({orders:null!=(e=n.error?void 0:n.data)?e:[]},n)}();return d(En,{orders:e})}function Yn(e){const{error:n}=Ee();return n?d(ge,{to:"/login"}):d(fe,l(o({},e),{children:e.children}))}function zn(e){const{isAdmin:n,error:t}=Ee();return t||!1===n?d(ge,{to:"/home"}):d(fe,l(o({},e),{children:e.children}))}function Vn(){return d(pe,{children:v(ve,{children:[d(fe,{exact:!0,path:"/",children:d(ge,{to:"/home"})}),d(fe,{path:"/login",component:vn}),d(fe,{path:"/register",component:Hn}),d(Yn,{path:"/checkout",component:Qe}),d(Yn,{path:"/detail/:id",component:tn}),d(Yn,{path:"/home",component:mn}),d(Yn,{path:"/search/:keyword?",component:fn}),d(Yn,{path:"/orders/:tab?",component:Rn}),d(zn,{path:"/dashboard/:tab?",component:Un})]})})}function Zn(){return d(xe,{children:d(Vn,{})})}(Ln=jn||(jn={})).submitted="submitted",Ln.shipped="shipped",Ln.delivered="delivered",Ln.cancelled="cancelled";be.render(d(Ne.StrictMode,{children:d(Zn,{})}),document.getElementById("root"));
