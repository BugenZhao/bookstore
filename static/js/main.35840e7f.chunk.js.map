{"version":3,"sources":["services/StoreContext.tsx","config.ts","services/index.tsx","services/auth.tsx","services/cart.tsx","components/Header.tsx","pages/common/Main.tsx","pages/common/Body.tsx","views/CartView.tsx","views/PaymentView.tsx","views/AddressView.tsx","pages/CheckoutPage.tsx","components/BookCard.tsx","views/BookDetailView.tsx","services/book.tsx","pages/DetailPage.tsx","views/CarouselView.tsx","services/carousel.tsx","views/BooksView.tsx","pages/HomePage.tsx","views/LoginRegView.tsx","pages/LoginPage.tsx","pages/SearchPage.tsx","views/ManagementView.tsx","views/BookManagementView.tsx","views/UserManagementView.tsx","pages/DashboardPage.tsx","pages/RegisterPage.tsx","services/order.tsx","pages/OrdersPage.tsx","routes.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["StoreContext","createContext","undefined","useStore","useContext","StoreProvider","props","useState","signedOut","setSignedOut","Provider","value","children","API_BASE","useFetch","path","fetcher","url","a","fetch","res","ok","json","useSWR","UserType","headers","post","body","method","delete_","postLogin","data","JSON","stringify","postRegister","useUser","r","isAdmin","error","user_type","admin","useCart","cartCount","_","books","map","b","count","sum","discount","total","putCart","id","Header","active","keyword","useRouteMatch","params","Navbar","bg","expand","className","Container","Brand","as","Link","to","Toggle","aria-controls","Collapse","Nav","Badge","pill","NavUserItem","SearchBox","initial","DashboardButton","history","useHistory","user","revalidate","OverlayTrigger","overlay","Tooltip","placement","onClick","push","username","inputRef","useRef","Form","onSubmit","input","current","length","FormControl","type","placeholder","defaultValue","ref","Button","variant","Main","py","Body","CartItem","book","link","ListGroup","Item","style","color","textDecoration","action","Row","Col","xs","Image","src","image","fluid","name","author","price","e","preventDefault","toString","Summary","title","textStyle","valuePrefix","toFixed","CartView","cartItems","PaymentContext","PaymentMethodItem","selected","setSelected","CreditCardForm","htmlFor","required","PaymentView","AddressContext","AddressItem","address","bgClass","tag","phone","AddNewAddressModal","modalShow","setModalShow","useForm","register","handleSubmit","Modal","show","size","onHide","backdrop","centered","closeButton","Title","alert","Group","Label","column","sm","Control","Check","label","Footer","form","AddNewAddressItem","AddressView","CheckoutMain","processing","setProcessing","disabled","CheckoutPage","BookCard","withLink","Card","Img","Subtitle","inventory","BookDetailView","height","isbn","description","ButtonGroup","useBooks","DetailPage","match","DetailMain","useBook","BreadCrumb","Spinner","animation","goBack","CarouselView","items","carousels","useCarousels","Carousel","alt","CarouselItem","triggerOnce","fade","Pagination","GalleryContext","page","setPage","totalPage","Math","ceil","pages","range","p","Books","setTotal","allBooks","allBooksIter","filter","values","join","includes","useEffect","booksThisPage","drop","take","cascade","damping","BooksView","HomePage","HomeMain","LoginRegTitle","isSignIn","select","primary","secondary","LoginRegView","isProcessing","LoginPage","banned","setBanned","wrong","setWrong","defaultValues","password","timeout","setTimeout","clearTimeout","Alert","toLowerCase","trigger","delay","autoComplete","autoFocus","isInvalid","Feedback","Switch","defaultChecked","SearchPage","SearchMain","ManagementView","rows","cols","onCommitChanges","booleanCols","columns","getRowId","row","defaultCurrentPage","pageSize","for","showAddCommand","showEditCommand","showDeleteCommand","BooleanFormatter","BooleanEditor","onValueChange","onChange","target","checked","BooleanTypeProvider","formatterComponent","editorComponent","BookManagementView","first","keys","k","titleize","added","changed","deleted","UserManagementView","users","useUsers","user_id","DashboardPage","DashboardMain","ResetBooksButton","rep","setRep","key","setKey","Tabs","activeKey","onSelect","Tab","eventKey","RegisterPage","watch","errors","formState","passwordValue","minLength","message","confirmPassword","validate","OrderStatus","OrdersPage","OrdersMain","OrderItem","order","cart","datetime","consignee","status","orderItems","example","delivered","useOrders","Table","responsive","SignedInRoute","AdminRoute","BSRoutes","exact","component","App","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.35840e7f.chunk.js","sourcesContent":["import { createContext, PropsWithChildren, useContext, useState } from \"react\";\nimport _ from \"lodash\";\n\ntype StoreContextType = {\n  signedOut: boolean;\n  setSignedOut: (s: boolean) => void;\n};\nexport const StoreContext = createContext<StoreContextType>(undefined!);\nexport function useStore() {\n  return useContext(StoreContext);\n}\n\nexport function StoreProvider(props: PropsWithChildren<{}>) {\n  const [signedOut, setSignedOut] = useState(false);\n\n  return (\n    <StoreContext.Provider\n      value={{\n        signedOut,\n        setSignedOut,\n      }}\n    >\n      {props.children}\n    </StoreContext.Provider>\n  );\n}\n","export const API_BASE = \"/api\";\n","import useSWR from \"swr\";\nimport { API_BASE } from \"../config\";\n\nexport type SelectContextType<T> = {\n  selected: T;\n  setSelected: (n: T) => void;\n};\n\nexport function useFetch<Data>(path: string) {\n  const fetcher = async (url: string) => {\n    const res = await fetch(url);\n    if (!res.ok) {\n      throw res;\n    }\n    return res.json();\n  };\n  const url = API_BASE + path;\n\n  return useSWR<Data, any>(url, fetcher);\n}\n\nconst headers = {\n  \"Content-type\": \"application/json; charset=UTF-8\",\n};\n\nexport function post(path: string, body?: BodyInit | null) {\n  const url = API_BASE + path;\n  return fetch(url, { method: \"POST\", body: body, headers: headers });\n}\n\nexport function put(path: string, body?: BodyInit | null) {\n  const url = API_BASE + path;\n  return fetch(url, { method: \"PUT\", body: body, headers: headers });\n}\n\nexport function delete_(path: string, body?: BodyInit | null) {\n  const url = API_BASE + path;\n  return fetch(url, { method: \"DELETE\", body: body, headers: headers });\n}\n","import { post, useFetch } from \".\";\n\nexport type LoginData = {\n  username: string;\n  password: string;\n};\n\nexport function postLogin(data: LoginData) {\n  return post(\"/users/login\", JSON.stringify(data));\n}\n\nexport function postLogout() {\n  return post(\"/users/logout\");\n}\n\nexport type RegisterData = {\n  username: string;\n  password: string;\n};\n\nexport function postRegister(data: RegisterData) {\n  return post(\"/users/register\", JSON.stringify(data));\n}\n\nexport enum UserType {\n  admin = 0,\n  normal = 1,\n}\n\nexport type AuthedUser = {\n  user_id: number;\n  username: string;\n  user_type: UserType;\n};\n\nexport function useUser() {\n  const r = useFetch<AuthedUser>(\"/users/check\");\n  const isAdmin =\n    r.data && !r.error ? r.data.user_type === UserType.admin : undefined;\n  return {\n    isAdmin,\n    ...r,\n  };\n}\n\nexport function useUsers() {\n  const r = useFetch<Record<number, AuthedUser>>(\"/users/\");\n  return {\n    users: r.error ? undefined : r.data,\n    ...r,\n  };\n}\n","import _ from \"lodash\";\nimport { delete_, post, put, useFetch } from \".\";\nimport { Book } from \"./book\";\n\nexport type Cart = {\n  books: { book: Book; count: number }[];\n  discount: number;\n  total: number;\n};\n\nexport function useCart() {\n  const r = useFetch<Cart>(\"/cart/\");\n  const cartCount =\n    r.data && !r.error\n      ? _(r.data.books)\n          .map((b) => b.count)\n          .sum()\n      : 0;\n  return {\n    books: (r.error ? undefined : r.data?.books) ?? [],\n    discount: (r.error ? undefined : r.data?.discount) ?? 0,\n    total: (r.error ? undefined : r.data?.total) ?? 0,\n    cartCount,\n    ...r,\n  };\n}\n\nexport function putCart(id: string) {\n  return put(`/cart/${id}`);\n}\n\nexport function deleteFromCart(id: string) {\n  return delete_(`/cart/${id}`);\n}\n\nexport function emptyCart() {\n  return delete_(\"/cart/\");\n}\n\nexport function checkout() {\n  return post(\"/cart/checkout\");\n}\n","import { useRef } from \"react\";\nimport { Bounce } from \"react-awesome-reveal\";\nimport {\n  Button,\n  OverlayTrigger,\n  Tooltip,\n  Nav,\n  Navbar,\n  Form,\n  FormControl,\n  Container,\n  Badge,\n} from \"react-bootstrap\";\nimport { Link, useHistory, useRouteMatch } from \"react-router-dom\";\nimport { SearchPageParams } from \"../routes\";\nimport { useStore } from \"../services/StoreContext\";\nimport _ from \"lodash\";\nimport { postLogout, useUser } from \"../services/auth\";\nimport { useCart } from \"../services/cart\";\n\nexport function Header({\n  active,\n}: {\n  active: \"home\" | \"detail\" | \"search\" | \"cart\" | \"orders\" | \"dashboard\";\n}) {\n  const { cartCount } = useCart();\n  const isAdmin = useUser().isAdmin ?? false;\n  const keyword = useRouteMatch<SearchPageParams>().params.keyword ?? \"\";\n\n  return (\n    <Navbar bg=\"white\" expand=\"lg\" className=\"shadow-sm fixed-top\">\n      <Container>\n        <Navbar.Brand className=\"fw-bolder\" as={Link} to=\"/home\">\n          Book Store\n        </Navbar.Brand>\n        <Navbar.Toggle aria-controls=\"basic-navbar-nav\" />\n        <Navbar.Collapse id=\"basic-navbar-nav\">\n          <Nav className=\"me-auto\">\n            <Nav.Link\n              as={Link}\n              to=\"/home\"\n              active={\n                active === \"home\" || active === \"detail\" || active === \"search\"\n              }\n            >\n              Books\n            </Nav.Link>\n            <Nav.Link as={Link} to=\"/checkout\" active={active === \"cart\"}>\n              <div className={`d-flex align-items-center`}>\n                <span className=\"me-1\">My Cart</span>\n                <Bounce>\n                  <Badge bg={cartCount === 0 ? \"secondary\" : \"danger\"} pill>\n                    {cartCount}\n                  </Badge>\n                </Bounce>\n              </div>\n            </Nav.Link>\n            <Nav.Link as={Link} to=\"/orders\" active={active === \"orders\"}>\n              My Orders\n            </Nav.Link>\n\n            <NavUserItem />\n          </Nav>\n\n          <SearchBox initial={keyword}></SearchBox>\n          {isAdmin ? <DashboardButton active={active} /> : null}\n        </Navbar.Collapse>\n      </Container>\n    </Navbar>\n  );\n}\n\nfunction NavUserItem() {\n  const { setSignedOut } = useStore();\n  const history = useHistory();\n  const { data: user, revalidate } = useUser();\n\n  return (\n    <OverlayTrigger\n      overlay={<Tooltip id=\"signout-tooltip\">Click to sign out</Tooltip>}\n      placement=\"auto\"\n    >\n      <Nav.Link\n        onClick={async () => {\n          await postLogout();\n          await revalidate();\n          setSignedOut(true);\n          history.push(\"/login\");\n        }}\n      >\n        <span>Hi, </span>\n        <span className=\"fw-bold\">{user?.username ?? \"???\"}</span>\n      </Nav.Link>\n    </OverlayTrigger>\n  );\n}\n\nfunction SearchBox({ initial = \"\" }) {\n  const inputRef = useRef<HTMLInputElement>(null!);\n  const history = useHistory();\n\n  return (\n    <Form\n      className=\"d-flex mb-2 mb-lg-0\"\n      onSubmit={() => {\n        const input = inputRef.current.value;\n        if (input.length > 0) {\n          history.push(`/search/${input}`);\n        }\n      }}\n    >\n      <FormControl\n        className=\"form-control me-2\"\n        type=\"search\"\n        placeholder=\"Search Books...\"\n        defaultValue={initial}\n        ref={inputRef}\n      />\n      <Button variant=\"outline-secondary\" type=\"submit\">\n        Search\n      </Button>\n    </Form>\n  );\n}\n\nfunction DashboardButton({ active }: { active: string }) {\n  return (\n    <div className=\"ms-lg-2 d-flex\">\n      {active === \"dashboard\" ? (\n        <Button as={Link} to=\"/home\" variant=\"success\" className=\"w-100\">\n          Book Store\n        </Button>\n      ) : (\n        <Button as={Link} to=\"/dashboard\" variant=\"primary\" className=\"w-100\">\n          Dashboard\n        </Button>\n      )}\n    </div>\n  );\n}\n","import { PropsWithChildren } from \"react\";\n\nexport function Main({\n  py = 4,\n  children,\n}: PropsWithChildren<{\n  py?: number;\n}>) {\n  return <main className={`py-${py} container`}>{children}</main>;\n}\n","import { PropsWithChildren } from \"react\";\n\nexport function Body(props: PropsWithChildren<{}>) {\n  return <div className=\"store-home\">{props.children}</div>;\n}\n","import { PropsWithChildren } from \"react\";\nimport _ from \"lodash\";\nimport { Book } from \"../services/book\";\nimport { Link } from \"react-router-dom\";\nimport { Badge, Button, Col, Image, ListGroup, Row } from \"react-bootstrap\";\nimport { deleteFromCart, emptyCart, useCart } from \"../services/cart\";\n\nfunction CartItem({ book, count }: { book: Book; count: number }) {\n  const link = `/detail/${book.id}`;\n  const { revalidate } = useCart();\n\n  return (\n    <ListGroup.Item\n      as={Link}\n      to={link}\n      style={{ color: \"inherit\", textDecoration: \"inherit\" }}\n      action\n    >\n      <Row className=\"d-flex justify-content-between\">\n        <Col xs={3}>\n          <Image src={book.image} fluid></Image>\n        </Col>\n        <Col className=\"d-flex align-items-center\">\n          <div className=\"me-auto\">\n            <h6 className=\"mb-0\">{book.name}</h6>\n            <small className=\"text-muted\">{book.author}</small>\n          </div>\n          <div className=\"me-3\">\n            <span className=\"h5\">¥{book.price}</span>\n            {count > 1 ? <span className=\"text-muted\"> x{count}</span> : null}\n          </div>\n          <Badge\n            pill\n            as={Button}\n            variant=\"danger\"\n            onClick={async (e) => {\n              e.preventDefault();\n              await deleteFromCart(book.id.toString());\n              await revalidate();\n            }}\n          >\n            —\n          </Badge>\n        </Col>\n      </Row>\n    </ListGroup.Item>\n  );\n}\n\nfunction Summary({\n  title,\n  value,\n}: PropsWithChildren<{\n  title: \"Discount\" | \"Total\";\n  value: number;\n}>) {\n  const textStyle = title === \"Discount\" ? \"text-danger\" : \"fw-bold\";\n  const valuePrefix = title === \"Discount\" ? \"-¥\" : \"¥\";\n\n  return (\n    <ListGroup.Item>\n      <div className=\"d-flex justify-content-between align-items-center\">\n        <div>\n          <span className=\"h6\">{title}</span>\n        </div>\n        <div>\n          <span className={`h5 ${textStyle}`}>\n            {valuePrefix}\n            {value.toFixed(2)}\n          </span>\n        </div>\n      </div>\n    </ListGroup.Item>\n  );\n}\n\nexport function CartView() {\n  const { books, cartCount, discount, total, revalidate } = useCart();\n\n  const cartItems = _(books)\n    .map((b) => <CartItem book={b.book} count={b.count} key={b.book.id} />)\n    .value();\n\n  return (\n    <div>\n      <h4 className=\"d-flex align-items-center mb-3\">\n        <span className=\"text-muted me-2\">My cart</span>\n        <Badge pill bg=\"secondary\" className=\"me-auto\">\n          {cartCount}\n        </Badge>\n        {cartCount > 0 ? (\n          <Badge\n            pill\n            as={Button}\n            variant=\"danger\"\n            onClick={async () => {\n              await emptyCart();\n              await revalidate();\n            }}\n          >\n            Clear\n          </Badge>\n        ) : null}\n      </h4>\n      <ul className=\"list-group mb-3\">\n        {cartItems}\n        <Summary title=\"Discount\" value={discount} />\n        <Summary title=\"Total\" value={total} />\n      </ul>\n    </div>\n  );\n}\n","import { createContext, PropsWithChildren, useContext, useState } from \"react\";\nimport { SelectContextType } from \"../services\";\n\nconst PaymentContext = createContext<SelectContextType<string>>(null!);\n\ntype PaymentMethod = \"PayPal\" | \"WeChat Pay\" | \"Alipay\" | \"Credit card\";\n\nfunction PaymentMethodItem({\n  name,\n  children,\n}: PropsWithChildren<{\n  name: PaymentMethod;\n}>) {\n  const { selected, setSelected } = useContext(PaymentContext);\n\n  return (\n    <button\n      onClick={() => setSelected(name)}\n      className={`list-group-item list-group-item-action ${\n        selected === name ? \"active\" : \"\"\n      }`}\n    >\n      <div className=\"d-flex w-100 justify-content-between align-items-center\">\n        <span>{name}</span>\n        {children}\n      </div>\n    </button>\n  );\n}\n\nfunction CreditCardForm() {\n  return (\n    <div className=\"col\">\n      <div className=\"row gy-2\">\n        <div className=\"col-md-6\">\n          <label htmlFor=\"cc-name\" className=\"form-label\">\n            Name on card\n          </label>\n          <input\n            type=\"text\"\n            className=\"form-control\"\n            id=\"cc-name\"\n            placeholder=\"\"\n            required\n          />\n        </div>\n\n        <div className=\"col-md-6\">\n          <label htmlFor=\"cc-number\" className=\"form-label\">\n            Card number\n          </label>\n          <input\n            type=\"text\"\n            className=\"form-control\"\n            id=\"cc-number\"\n            placeholder=\"\"\n            required\n          />\n        </div>\n\n        <div className=\"col-md-6\">\n          <label htmlFor=\"cc-expiration\" className=\"form-label\">\n            Expiration\n          </label>\n          <input\n            type=\"text\"\n            className=\"form-control\"\n            id=\"cc-expiration\"\n            placeholder=\"\"\n            required\n          />\n        </div>\n\n        <div className=\"col-md-6\">\n          <label htmlFor=\"cc-cvv\" className=\"form-label\">\n            CVV\n          </label>\n          <input\n            type=\"text\"\n            className=\"form-control\"\n            id=\"cc-cvv\"\n            placeholder=\"\"\n            required\n          />\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport function PaymentView() {\n  const [selected, setSelected] = useState(\"Credit card\");\n\n  return (\n    <PaymentContext.Provider value={{ selected, setSelected }}>\n      <div>\n        <h4 className=\"mb-3\">Payment</h4>\n        <div className=\"row gy-2\">\n          <div className=\"col-lg-5 col-xxl-4\">\n            <div className=\"list-group\">\n              <PaymentMethodItem name=\"PayPal\" />\n              <PaymentMethodItem name=\"WeChat Pay\">\n                <span className=\"badge bg-success rounded-pill\">\n                  Recommended\n                </span>\n              </PaymentMethodItem>\n              <PaymentMethodItem name=\"Alipay\" />\n              <PaymentMethodItem name=\"Credit card\">\n                <span className=\"badge bg-secondary rounded-pill\">\n                  Last used\n                </span>\n              </PaymentMethodItem>\n            </div>\n          </div>\n\n          {selected === \"Credit card\" ? (\n            <CreditCardForm />\n          ) : (\n            <div className=\"col\">\n              You'll be redirected to {selected} after clicking \"Checkout\".\n            </div>\n          )}\n        </div>\n      </div>\n    </PaymentContext.Provider>\n  );\n}\n","import { createContext, useContext, useState } from \"react\";\nimport { Modal, Button, Form, Row, Col } from \"react-bootstrap\";\nimport { useForm } from \"react-hook-form\";\nimport { SelectContextType } from \"../services\";\n\ntype AddressContextType = SelectContextType<number> & {\n  modalShow: boolean;\n  setModalShow: (b: boolean) => void;\n};\nconst AddressContext = createContext<AddressContextType>(null!);\n\nexport type NewAddressData = {\n  name: string;\n  phone: string;\n  address: string;\n};\n\nexport type Address = NewAddressData & {\n  id: number;\n  tag: string;\n};\n\nfunction AddressItem({ address }: { address: Address }) {\n  const bgClass = address.tag === \"Default\" ? \"bg-secondary\" : \"bg-success\";\n  const { selected, setSelected } = useContext(AddressContext);\n\n  return (\n    <button\n      onClick={() => setSelected(address.id)}\n      className={`list-group-item list-group-item-action ${\n        selected === address.id ? \"active\" : \"\"\n      }`}\n    >\n      <div className=\"d-flex w-100 justify-content-between align-items-center\">\n        <h5 className=\"mb-1\">{address.name}</h5>\n        <span className={`badge ${bgClass} rounded-pill`}>{address.tag}</span>\n      </div>\n      <p className=\"mb-0 small\">{address.phone}</p>\n      <p className=\"mb-0\">{address.address}</p>\n    </button>\n  );\n}\n\nfunction AddNewAddressModal() {\n  const { modalShow, setModalShow } = useContext(AddressContext);\n  const { register, handleSubmit } = useForm<NewAddressData>();\n\n  return (\n    <Modal\n      show={modalShow}\n      size=\"lg\"\n      onHide={() => setModalShow(false)}\n      backdrop=\"static\"\n      centered\n    >\n      <Modal.Header closeButton>\n        <Modal.Title>Add a New Address</Modal.Title>\n      </Modal.Header>\n      <Modal.Body>\n        <Form\n          onSubmit={handleSubmit((data) => {\n            alert(JSON.stringify(data));\n            setModalShow(false);\n          })}\n          id=\"add-new-address-form\"\n        >\n          <Form.Group as={Row} className=\"mb-3\">\n            <Form.Label column sm={3}>\n              Name\n            </Form.Label>\n            <Col sm={9}>\n              <Form.Control\n                placeholder=\"Enter full name\"\n                required\n                {...register(\"name\")}\n              />\n            </Col>\n          </Form.Group>\n\n          <Form.Group as={Row} className=\"mb-3\">\n            <Form.Label column sm={3}>\n              Phone Number\n            </Form.Label>\n            <Col sm={9}>\n              <Form.Control\n                placeholder=\"Enter phone number\"\n                required\n                {...register(\"phone\")}\n              />\n            </Col>\n          </Form.Group>\n\n          <Form.Group as={Row} className=\"mb-3\">\n            <Form.Label column sm={3}>\n              Address\n            </Form.Label>\n            <Col sm={9}>\n              <Form.Control\n                as=\"textarea\"\n                placeholder=\"Enter address\"\n                required\n                {...register(\"address\")}\n              />\n            </Col>\n          </Form.Group>\n\n          <Form.Group className=\"mb-3\">\n            <Form.Check\n              type=\"checkbox\"\n              label=\"Set as default\"\n              id=\"set-as-default\"\n            />\n          </Form.Group>\n        </Form>\n      </Modal.Body>\n      <Modal.Footer>\n        <Button variant=\"primary\" type=\"submit\" form=\"add-new-address-form\">\n          Confirm\n        </Button>\n      </Modal.Footer>\n    </Modal>\n  );\n}\n\nfunction AddNewAddressItem() {\n  const { setModalShow } = useContext(AddressContext);\n  return (\n    <>\n      <button\n        className=\"list-group-item list-group-item-action\"\n        onClick={() => setModalShow(true)}\n      >\n        <span className=\"text-muted\">Add a new address...</span>\n      </button>\n    </>\n  );\n}\n\nexport function AddressView() {\n  const [selected, setSelected] = useState(0);\n  const [modalShow, setModalShow] = useState(false);\n\n  return (\n    <AddressContext.Provider\n      value={{ selected, setSelected, modalShow, setModalShow }}\n    >\n      <div>\n        <h4 className=\"mb-3\">Shipping Address</h4>\n        <div>\n          <div className=\"list-group\">\n            <AddressItem\n              address={{\n                id: 0,\n                name: \"Bugen Zhao\",\n                tag: \"Default\",\n                phone: \"+86 155 2121 2121\",\n                address: \"1234 Main St., Minhang, Shanghai, China\",\n              }}\n            />\n            <AddressItem\n              address={{\n                id: 1,\n                name: \"Alice Cook\",\n                tag: \"Home\",\n                phone: \"+1 802 812 3456\",\n                address: \"4321 Home St., Cupertino, CA, United States\",\n              }}\n            />\n            <AddressItem\n              address={{\n                id: 2,\n                name: \"Dave Jobs\",\n                tag: \"School\",\n                phone: \"+86 188 1234 5678\",\n                address: \"9876 School St., Shanghai, China\",\n              }}\n            />\n            <AddNewAddressItem />\n            <AddNewAddressModal />\n          </div>\n        </div>\n      </div>\n    </AddressContext.Provider>\n  );\n}\n","import { Header } from \"../components/Header\";\nimport { Main } from \"./common/Main\";\nimport { Body } from \"./common/Body\";\nimport { CartView } from \"../views/CartView\";\nimport { PaymentView } from \"../views/PaymentView\";\nimport { AddressView } from \"../views/AddressView\";\nimport { Fade } from \"react-awesome-reveal\";\nimport { checkout, useCart } from \"../services/cart\";\nimport { Modal } from \"react-bootstrap\";\nimport { useState } from \"react\";\nimport { Link } from \"react-router-dom\";\n\nfunction CheckoutMain() {\n  const { revalidate } = useCart();\n  const [modalShow, setModalShow] = useState(false);\n  const [processing, setProcessing] = useState(false);\n\n  return (\n    <div>\n      <Modal\n        show={modalShow}\n        onHide={() => {\n          setModalShow(false);\n          setProcessing(false);\n        }}\n      >\n        <Modal.Header closeButton>\n          <Modal.Title>Checkout Success</Modal.Title>\n        </Modal.Header>\n        <Modal.Body>\n          Go to <Link to=\"/orders\">My Orders</Link> to check the order.\n        </Modal.Body>\n      </Modal>\n      <div className=\"row\">\n        <div className=\"col-md-6 col-lg-5 order-md-last\">\n          <CartView />\n        </div>\n        <div className=\"col-md-6 col-lg-7\">\n          <AddressView />\n          <hr className=\"my-4\" />\n          <PaymentView />\n          <hr className=\"my-4\" />\n          <div className=\"d-flex justify-content-end\">\n            <button\n              className=\"btn btn-primary btn-lg col-12 col-lg-3\"\n              type=\"submit\"\n              disabled={processing}\n              onClick={async () => {\n                setProcessing(true);\n                await checkout();\n                await revalidate();\n                setModalShow(true);\n              }}\n            >\n              {processing ? \"Processing...\" : \"Checkout\"}\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport function CheckoutPage() {\n  return (\n    <Body>\n      <Header active=\"cart\" />\n      <Main py={5}>\n        <Fade>\n          <CheckoutMain />\n        </Fade>\n      </Main>\n    </Body>\n  );\n}\n","import { Card } from \"react-bootstrap\";\nimport { Link } from \"react-router-dom\";\nimport { Book } from \"../services/book\";\n\nexport function BookCard({\n  book,\n  withLink = true,\n}: {\n  book: Book;\n  withLink: boolean;\n}) {\n  const path = `/detail/${book.id}`;\n\n  return (\n    <Card>\n      {withLink ? (\n        <Card.Link className=\"stretched-link\" as={Link} to={path} />\n      ) : null}\n      <Card.Img variant=\"top\" src={book.image} />\n      <Card.Body>\n        <Card.Title className=\"text-truncate\">{book.name}</Card.Title>\n        <div className=\"d-flex justify-content-between align-items-center\">\n          <Card.Subtitle className=\"text-danger\" as=\"h6\">\n            ¥{book.price}\n          </Card.Subtitle>\n          <Card.Subtitle className=\"text-muted\" as=\"small\">\n            {book.inventory}+\n          </Card.Subtitle>\n        </div>\n      </Card.Body>\n    </Card>\n  );\n}\n","import { ButtonGroup, Button } from \"react-bootstrap\";\nimport { Link } from \"react-router-dom\";\nimport { Book } from \"../services/book\";\nimport { putCart, useCart } from \"../services/cart\";\n\nexport function BookDetailView({ book }: { book: Book }) {\n  const { revalidate } = useCart();\n\n  return (\n    <div\n      className=\"d-flex flex-column justify-content-between\"\n      style={{ height: \"100%\" }}\n    >\n      <div>\n        <h1 className=\"h2 my-3\">{book.name}</h1>\n        <div className=\"mb-3\">\n          <dl className=\"row\">\n            <dt className=\"col-sm-3\">Author</dt>\n            <dd className=\"col-sm-9\">{book.author}</dd>\n\n            <dt className=\"col-sm-3\">Press</dt>\n            <dd className=\"col-sm-9\">Unknown Press</dd>\n\n            <dt className=\"col-sm-3\">ISBN</dt>\n            <dd className=\"col-sm-9\">{book.isbn}</dd>\n\n            <dt className=\"col-sm-3\">Category</dt>\n            <dd className=\"col-sm-9\">{book.type}</dd>\n\n            <dt className=\"col-sm-3\">Stock</dt>\n            <dd className=\"col-sm-9\">{book.inventory}+</dd>\n\n            <dt className=\"col-sm-3\">Price</dt>\n            <dd className=\"col-sm-9 text-danger fw-bold\">¥{book.price}</dd>\n\n            <dt className=\"col-sm-3\">Introduction</dt>\n            <dd className=\"col-sm-9\">{book.description}</dd>\n          </dl>\n        </div>\n      </div>\n      <div className=\"my-3\">\n        <div className=\"d-flex justify-content-end\">\n          <ButtonGroup className=\"col-12 col-xl-6 col-lg-8\" size=\"lg\">\n            <Button\n              variant=\"outline-danger\"\n              className=\"w-100\"\n              onClick={async () => {\n                await putCart(book.id.toString());\n                await revalidate();\n              }}\n            >\n              Add to Cart\n            </Button>\n            <Button\n              variant=\"outline-danger\"\n              className=\"w-100\"\n              as={Link}\n              to=\"/checkout\"\n            >\n              Checkout\n            </Button>\n          </ButtonGroup>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { useFetch } from \".\";\n\nexport type Book = {\n  id: number;\n  isbn: string;\n  name: string;\n  type: string;\n  author: string;\n  price: number;\n  description: string;\n  inventory: number;\n  image: string;\n};\n\nexport type BookDict = Record<string, Book>;\n\nexport function useBook(id: string) {\n  const r = useFetch<Book>(`/books/${id}`);\n  return {\n    book: r.error ? undefined : r.data,\n    ...r,\n  };\n}\n\nexport function useBooks() {\n  const r = useFetch<BookDict>(`/books/`);\n  return {\n    books: r.error ? undefined : r.data,\n    ...r,\n  };\n}\n","import { Link, RouteComponentProps, useHistory } from \"react-router-dom\";\nimport { BookCard } from \"../components/BookCard\";\nimport { Header } from \"../components/Header\";\nimport { BookDetailView } from \"../views/BookDetailView\";\nimport { Main } from \"./common/Main\";\nimport { Body } from \"./common/Body\";\nimport { Fade } from \"react-awesome-reveal\";\nimport { Row, Spinner } from \"react-bootstrap\";\nimport { useBook } from \"../services/book\";\n\nexport function DetailPage(\n  props: RouteComponentProps<{\n    id: string;\n  }>\n) {\n  const id = props.match.params.id;\n\n  return (\n    <Body>\n      <Header active=\"detail\" />\n      <Main py={5}>\n        <DetailMain id={id} />\n      </Main>\n    </Body>\n  );\n}\n\nfunction DetailMain({ id }: { id: string }) {\n  const { book } = useBook(id);\n\n  if (!book) {\n    return (\n      <div>\n        <BreadCrumb />\n        <Row className=\"justify-content-center mt-5\">\n          <Spinner animation=\"border\" variant=\"primary\" />\n        </Row>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <BreadCrumb name={book.name} />\n      <Fade>\n        <Row>\n          <div className=\"col-md-5 col-lg-4 align-self-center\">\n            <BookCard book={book} withLink={false} />\n          </div>\n          <div className=\"col-md-7 col-lg-8\">\n            <BookDetailView book={book} />\n          </div>\n        </Row>\n      </Fade>\n    </div>\n  );\n}\n\nfunction BreadCrumb({ name }: { name?: string }) {\n  const history = useHistory();\n\n  return (\n    <nav>\n      <ol className=\"breadcrumb h6\">\n        <li className=\"breadcrumb-item\">\n          <Link to=\"#\" className=\"\" onClick={() => history.goBack()}>\n            Books\n          </Link>\n        </li>\n        {name ? (\n          <li className=\"breadcrumb-item active\">{name}</li>\n        ) : (\n          <li className=\"breadcrumb-item\">...</li>\n        )}\n      </ol>\n    </nav>\n  );\n}\n","import { Fade } from \"react-awesome-reveal\";\nimport { Carousel } from \"react-bootstrap\";\nimport { useCarousels } from \"../services/carousel\";\n\nfunction CarouselItem(url: string) {\n  return (\n    <Carousel.Item key={url}>\n      <img className=\"d-block w-100\" src={url} alt={url} />\n    </Carousel.Item>\n  );\n}\n\nexport function CarouselView() {\n  const paths = useCarousels().carousels;\n  const items = paths.map((url) => CarouselItem(url));\n\n  return (\n    <Fade triggerOnce>\n      <Carousel className=\"mb-4\" fade>\n        {items}\n      </Carousel>\n    </Fade>\n  );\n}\n","import { useFetch } from \".\";\n\nexport function useCarousels() {\n  const r = useFetch<string[]>(\"/carousels/\");\n  return {\n    carousels: (r.error ? undefined : r.data) ?? [],\n    ...r,\n  };\n}\n","import { createContext, useContext, useEffect, useState } from \"react\";\nimport { useRouteMatch } from \"react-router-dom\";\nimport _ from \"lodash\";\nimport { BookCard } from \"../components/BookCard\";\nimport { SearchPageParams } from \"../routes\";\nimport { Fade } from \"react-awesome-reveal\";\nimport { Row, Spinner } from \"react-bootstrap\";\nimport { useBooks } from \"../services/book\";\n\nconst PER_PAGE = 12;\n\nfunction Pagination() {\n  const { total, page, setPage } = useContext(GalleryContext);\n  const totalPage = Math.ceil(total / PER_PAGE);\n\n  const pages = _(_.range(1, totalPage + 1))\n    .map((p) => (\n      <li className={`page-item ${p === page ? \"active\" : \"\"}`} key={p}>\n        <button className=\"page-link\" onClick={() => setPage(p)}>\n          {p}\n        </button>\n      </li>\n    ))\n    .value();\n\n  return (\n    <div className=\"py-5\" id=\"footer\">\n      <nav>\n        <ul className=\"pagination justify-content-center\">\n          <li className={`page-item ${page === 1 ? \"disabled\" : \"\"}`}>\n            <button className=\"page-link\" onClick={() => setPage(page - 1)}>\n              Previous\n            </button>\n          </li>\n          {pages}\n          <li className={`page-item ${page === totalPage ? \"disabled\" : \"\"}`}>\n            <button className=\"page-link\" onClick={() => setPage(page + 1)}>\n              Next\n            </button>\n          </li>\n        </ul>\n      </nav>\n    </div>\n  );\n}\n\nfunction Books() {\n  const { setTotal, page } = useContext(GalleryContext);\n  const keyword = useRouteMatch<SearchPageParams>().params.keyword ?? \"\";\n  const { books: allBooks } = useBooks();\n\n  const allBooksIter = _(allBooks).filter((book) =>\n    _(book).values().join().includes(keyword)\n  );\n  useEffect(() => setTotal(allBooksIter.size()));\n\n  if (!allBooks) {\n    return (\n      <Row className=\"justify-content-center mt-5\">\n        <Spinner animation=\"border\" variant=\"primary\" />\n      </Row>\n    );\n  }\n\n  const booksThisPage = allBooksIter\n    .map((book) => (\n      <div key={`book${book.id}`} className=\"col\">\n        <BookCard book={book} withLink />\n      </div>\n    ))\n    .drop((page - 1) * PER_PAGE)\n    .take(PER_PAGE)\n    .value();\n\n  return (\n    <div\n      className=\"row row-cols-2 row-cols-md-3 row-cols-lg-4 row-cols-xl-5 row-cols-xxl-6 g-3\"\n      id=\"books\"\n    >\n      <Fade cascade damping={0.025} triggerOnce>\n        {booksThisPage}\n      </Fade>\n    </div>\n  );\n}\n\ntype GalleryContextType = {\n  total: number;\n  setTotal: (n: number) => void;\n  page: number;\n  setPage: (n: number) => void;\n};\n\nconst GalleryContext = createContext<GalleryContextType>(null!);\n\nexport function BooksView() {\n  const [total, setTotal] = useState(0);\n  const [page, setPage] = useState(1);\n\n  return (\n    <GalleryContext.Provider value={{ total, setTotal, page, setPage }}>\n      <div>\n        <Books />\n        <Pagination />\n      </div>\n    </GalleryContext.Provider>\n  );\n}\n","import { Header } from \"../components/Header\";\nimport { CarouselView } from \"../views/CarouselView\";\nimport { BooksView } from \"../views/BooksView\";\nimport { Main } from \"./common/Main\";\nimport { Body } from \"./common/Body\";\n\nexport function HomePage() {\n  return (\n    <Body>\n      <Header active=\"home\" />\n      <Main>\n        <HomeMain />\n      </Main>\n    </Body>\n  );\n}\n\nfunction HomeMain() {\n  return (\n    <div>\n      <CarouselView />\n      <BooksView />\n    </div>\n  );\n}\n","import { PropsWithChildren } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport { Fade } from \"react-awesome-reveal\";\nimport { Button } from \"react-bootstrap\";\n\nfunction LoginRegTitle({\n  isSignIn,\n}: PropsWithChildren<{\n  isSignIn: boolean;\n}>) {\n  const select = (b: boolean) => (b ? \"Sign in\" : \"Sign up\");\n  const primary = select(isSignIn);\n  const secondary = select(!isSignIn);\n  const link = isSignIn ? \"/register\" : \"/login\";\n\n  return (\n    <>\n      <h1 className=\"mb-3\">\n        <span className=\"h1 fw-bold\">{primary}</span>\n        <span className=\"h4\"> / </span>\n        <Link className=\"h5 fw-bold text-muted\" to={link}>\n          {secondary}\n        </Link>\n      </h1>\n    </>\n  );\n}\n\nexport function LoginRegView({\n  isSignIn,\n  children,\n  onSubmit,\n  isProcessing,\n}: PropsWithChildren<{\n  isSignIn: boolean;\n  onSubmit: () => void;\n  isProcessing: boolean;\n}>) {\n  return (\n    <>\n      <main className=\"form-signin\">\n        <Fade>\n          <LoginRegTitle isSignIn={isSignIn} />\n          <form onSubmit={onSubmit}>\n            {children}\n            <Button\n              className=\"w-100 mt-3\"\n              variant=\"dark\"\n              size=\"lg\"\n              type=\"submit\"\n              disabled={isProcessing}\n            >\n              {isProcessing ? \"Signing \" : \"Sign \"}\n              {isSignIn ? \"in\" : \"up\"}\n              {isProcessing ? \"...\" : \"\"}\n            </Button>\n          </form>\n        </Fade>\n      </main>\n    </>\n  );\n}\n","import { useEffect, useState } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport { useStore } from \"../services/StoreContext\";\nimport { Alert, Form, OverlayTrigger } from \"react-bootstrap\";\nimport { LoginRegView } from \"../views/LoginRegView\";\nimport { useForm } from \"react-hook-form\";\nimport { useUser } from \"../services/auth\";\nimport { LoginData, postLogin } from \"../services/auth\";\n\ntype LoginFormData = LoginData;\n\nexport function LoginPage() {\n  const { signedOut, setSignedOut } = useStore();\n  const { revalidate } = useUser();\n  const history = useHistory();\n  const [banned, setBanned] = useState(false);\n  const [processing, setProcessing] = useState(false);\n  const [wrong, setWrong] = useState(false);\n\n  const { register, handleSubmit } = useForm<LoginFormData>({\n    defaultValues: {\n      username: \"thunderboy\",\n      password: \"reins1409\",\n    },\n  });\n\n  useEffect(() => {\n    const timeout = setTimeout(() => {\n      setSignedOut(false);\n      setBanned(false);\n    }, 3000);\n\n    return () => {\n      clearTimeout(timeout);\n      setSignedOut(false);\n    };\n  }, [setSignedOut, banned]);\n\n  return (\n    <>\n      <Alert show={signedOut} variant=\"primary\" className=\"text-center h5\">\n        You have signed out.\n      </Alert>\n      <Alert show={banned} variant=\"danger\" className=\"text-center h5\">\n        Your account has been banned by administrators.\n      </Alert>\n      <LoginRegView\n        isSignIn\n        onSubmit={handleSubmit(async (data) => {\n          if (data.username.toLowerCase() === \"banned\") {\n            // TODO: real ban\n            setBanned(true);\n          } else {\n            setProcessing(true);\n            const res = await postLogin(data);\n            await revalidate();\n            setProcessing(false);\n            if (res.ok) {\n              setSignedOut(false);\n              history.push(\"/home\");\n            } else {\n              setWrong(true);\n            }\n          }\n        })}\n        isProcessing={processing}\n      >\n        <OverlayTrigger\n          placement=\"bottom-end\"\n          trigger=\"focus\"\n          delay={300}\n          overlay={\n            // <Tooltip id=\"user-tooltip\">\n            //   Sign in as <strong>{ADMINS.join(\" or \")}</strong> to obtain the\n            //   admin permissions.\n            // </Tooltip>\n            <div />\n          }\n        >\n          <Form.Control\n            className=\"input-first\"\n            placeholder=\"Username\"\n            autoComplete=\"username\"\n            required\n            autoFocus\n            isInvalid={wrong}\n            {...register(\"username\")}\n          />\n        </OverlayTrigger>\n        <Form.Control\n          className=\"input-last\"\n          placeholder=\"Password\"\n          type=\"password\"\n          required\n          isInvalid={wrong}\n          {...register(\"password\")}\n        ></Form.Control>\n\n        {wrong ? (\n          <Form.Control.Feedback type=\"invalid\">\n            Please try again.\n          </Form.Control.Feedback>\n        ) : null}\n        \n        <Form.Switch className=\"mt-3\" label=\"Remember me\" defaultChecked />\n      </LoginRegView>\n    </>\n  );\n}\n","import { Header } from \"../components/Header\";\nimport { BooksView } from \"../views/BooksView\";\nimport { Main } from \"./common/Main\";\nimport { Body } from \"./common/Body\";\nimport { useRouteMatch } from \"react-router\";\nimport { SearchPageParams } from \"../routes\";\n\nexport function SearchPage() {\n  return (\n    <Body>\n      <Header active=\"search\" />\n      <Main>\n        <SearchMain />\n      </Main>\n    </Body>\n  );\n}\n\nfunction SearchMain() {\n  const keyword = useRouteMatch<SearchPageParams>().params.keyword ?? \"\";\n\n  return (\n    <div>\n      <div className=\"py-5\">\n        <span className=\"h1\">Search Results for \"{keyword}\"</span>\n      </div>\n      <BooksView />\n    </div>\n  );\n}\n","import {\n  EditingState,\n  PagingState,\n  IntegratedPaging,\n  ChangeSet,\n  SearchState,\n  IntegratedFiltering,\n  DataTypeProvider,\n  DataTypeProviderProps,\n} from \"@devexpress/dx-react-grid\";\nimport {\n  Grid,\n  Table,\n  TableHeaderRow,\n  TableEditRow,\n  TableEditColumn,\n  PagingPanel,\n  SearchPanel,\n  Toolbar,\n} from \"@devexpress/dx-react-grid-bootstrap4\";\nimport { PropsWithChildren } from \"react\";\nimport { Form } from \"react-bootstrap\";\n\nexport function ManagementView<T>({\n  rows,\n  cols,\n  onCommitChanges,\n  booleanCols,\n  children,\n}: PropsWithChildren<{\n  rows: T[];\n  cols: { name: string; title: string }[];\n  onCommitChanges: ({ added, changed, deleted }: ChangeSet) => void;\n  booleanCols?: string[];\n}>) {\n  return (\n    <div className=\"card\">\n      <Grid rows={rows} columns={cols} getRowId={(row) => row.id}>\n        <SearchState />\n        <IntegratedFiltering />\n        <PagingState defaultCurrentPage={0} pageSize={20} />\n        <IntegratedPaging />\n        {booleanCols ? <BooleanTypeProvider for={booleanCols} /> : null}\n        {children}\n        <EditingState onCommitChanges={onCommitChanges} />\n        <Table />\n        <TableHeaderRow />\n        <TableEditRow />\n        <TableEditColumn showAddCommand showEditCommand showDeleteCommand />\n        <Toolbar />\n        <SearchPanel />\n        <PagingPanel />\n      </Grid>\n    </div>\n  );\n}\n\nconst BooleanFormatter = ({ value }: { value: boolean }) => (\n  <Form.Check type=\"checkbox\" defaultChecked={value} disabled />\n);\n\nconst BooleanEditor = ({\n  value,\n  onValueChange,\n}: {\n  value: boolean;\n  onValueChange: (b: boolean) => void;\n}) => (\n  <Form.Check\n    type=\"checkbox\"\n    defaultChecked={value}\n    onChange={(e) => onValueChange(e.target.checked)}\n  />\n);\n\nconst BooleanTypeProvider = ({ for: booleanCols }: DataTypeProviderProps) => (\n  <DataTypeProvider\n    formatterComponent={BooleanFormatter}\n    editorComponent={BooleanEditor}\n    for={booleanCols}\n  />\n);\n","import _ from \"lodash\";\nimport { ChangeSet } from \"@devexpress/dx-react-grid\";\nimport \"@devexpress/dx-react-grid-bootstrap4/dist/dx-react-grid-bootstrap4.css\";\n\n// import produce from \"immer\";\nimport { ManagementView } from \"./ManagementView\";\nimport titleize from \"titleize\";\nimport { useBooks } from \"../services/book\";\n\nexport function BookManagementView() {\n  const { books } = useBooks();\n  const rows = _.values(books);\n  const cols = _(_.first(rows))\n    .keys()\n    // .filter((k) => k !== \"id\")\n    .map((k) => {\n      return { name: k, title: titleize(k) };\n    })\n    .value();\n\n  function onCommitChanges({ added, changed, deleted }: ChangeSet) {\n    if (added) {\n      // [row]\n      // setBOOKS(\n      //   produce(BOOKS, (bs) => {\n      //     _(added).forEach((rowAdded) => {\n      //       const newId = _(BOOKS).keys().max() ?? 0 + 1;\n      //       bs[newId] = { ...rowAdded, id: newId };\n      //     });\n      //   })\n      // );\n    }\n\n    if (changed) {\n      // {id: row}\n      // setBOOKS(\n      //   produce(BOOKS, (bs) => {\n      //     _(changed)\n      //       .toPairs()\n      //       .forEach(([id, rowChanged]) => {\n      //         bs[id] = { ...bs[id], ...rowChanged };\n      //       });\n      //   })\n      // );\n    }\n\n    if (deleted) {\n      // [rowIdx]\n      // if (_.size(BOOKS) <= deleted.length) {\n      //   return;\n      // }\n      // setBOOKS(\n      //   produce(BOOKS, (bs) => {\n      //     _(deleted).forEach((id) => {\n      //       delete bs[id];\n      //     });\n      //   })\n      // );\n      // clearCart();\n    }\n  }\n\n  return (\n    <ManagementView rows={rows} cols={cols} onCommitChanges={onCommitChanges} />\n  );\n}\n","import _ from \"lodash\";\nimport { UserType, useUsers } from \"../services/auth\";\nimport { ManagementView } from \"./ManagementView\";\n\nexport function UserManagementView() {\n  const { users } = useUsers();\n  const rows = _.values(users).map((user) => {\n    return {\n      id: user.user_id,\n      admin: user.user_type === UserType.admin,\n      ...user,\n    };\n  });\n  const cols = [\n    { name: \"user_id\", title: \"User ID\" },\n    { name: \"username\", title: \"Username\" },\n    { name: \"admin\", title: \"Admin\" },\n  ];\n\n  return (\n    <ManagementView\n      rows={rows}\n      cols={cols}\n      booleanCols={[\"admin\"]}\n      onCommitChanges={() => {}}\n    ></ManagementView>\n  );\n}\n","import { Header } from \"../components/Header\";\nimport { Main } from \"./common/Main\";\nimport { Body } from \"./common/Body\";\nimport { BookManagementView } from \"../views/BookManagementView\";\nimport { UserManagementView } from \"../views/UserManagementView\";\nimport { Button, Tab, Tabs } from \"react-bootstrap\";\nimport { useState } from \"react\";\n\nexport function DashboardPage() {\n  return (\n    <Body>\n      <Header active=\"dashboard\" />\n      <Main>\n        <DashboardMain />\n      </Main>\n    </Body>\n  );\n}\n\nfunction ResetBooksButton() {\n  const [rep, setRep] = useState(false);\n\n  return (\n    <Button\n      size=\"lg\"\n      variant=\"outline-danger\"\n      className=\"align-self-center\"\n      onClick={() => {\n        if (rep) {\n          // setBOOKS(ALL_BOOKS);\n        }\n        setRep(!rep);\n      }}\n    >\n      {rep ? \"Click again to reset\" : \"Reset all books\"}\n    </Button>\n  );\n}\n\nfunction DashboardMain() {\n  const [key, setKey] = useState<string | undefined>(\"books\");\n\n  return (\n    <div>\n      <div className=\"d-flex justify-content-between\">\n        <span className=\"h1\">Dashboard</span>\n        {\n          key === \"books\" ? <ResetBooksButton /> : null\n          // <h4 className=\"align-self-center\">\n          //   <Badge bg=\"info\">Demo</Badge>\n          // </h4>\n        }\n      </div>\n      <div className=\"py-4\">\n        <Tabs\n          activeKey={key}\n          onSelect={(k) => setKey(k ?? undefined)}\n          className=\"mb-3\"\n        >\n          <Tab eventKey=\"books\" title=\"Books\">\n            <BookManagementView />\n          </Tab>\n          <Tab eventKey=\"users\" title=\"Users\">\n            <UserManagementView />\n          </Tab>\n        </Tabs>\n      </div>\n    </div>\n  );\n}\n","import { useHistory } from \"react-router-dom\";\nimport { useStore } from \"../services/StoreContext\";\nimport { Form } from \"react-bootstrap\";\nimport { LoginRegView } from \"../views/LoginRegView\";\nimport { useForm } from \"react-hook-form\";\nimport { useState } from \"react\";\nimport { postRegister, RegisterData } from \"../services/auth\";\nimport { useUser } from \"../services/auth\";\n\nexport type RegisterFormData = RegisterData & {\n  confirmPassword: string;\n};\n\nexport function RegisterPage() {\n  const { setSignedOut } = useStore();\n  const { revalidate } = useUser();\n  const history = useHistory();\n  const [processing, setProcessing] = useState(false);\n  const [wrong, setWrong] = useState(false);\n\n  const {\n    register,\n    handleSubmit,\n    watch,\n    formState: { errors },\n  } = useForm<RegisterFormData>();\n\n  const passwordValue = watch(\"password\");\n\n  return (\n    <>\n      <LoginRegView\n        isSignIn={false}\n        onSubmit={handleSubmit(async (data) => {\n          setProcessing(true);\n          const res = await postRegister({\n            username: data.username,\n            password: data.password,\n          });\n          await revalidate();\n          setProcessing(false);\n          if (res.ok) {\n            setSignedOut(false);\n            history.push(\"/home\");\n          } else {\n            setWrong(true);\n          }\n        })}\n        isProcessing={processing}\n      >\n        <Form.Control\n          className=\"input-first\"\n          placeholder=\"Username\"\n          autoComplete=\"username\"\n          required\n          isInvalid={wrong}\n          {...register(\"username\")}\n        ></Form.Control>\n        <Form.Control\n          className=\"input-mid\"\n          placeholder=\"Password\"\n          type=\"password\"\n          autoComplete=\"new-password\"\n          required\n          isInvalid={!!errors.password}\n          {...register(\"password\", {\n            minLength: {\n              value: 4,\n              message: \"Password must have at least 4 characters.\",\n            },\n          })}\n        ></Form.Control>\n\n        <Form.Control\n          className=\"input-last\"\n          placeholder=\"Confirm Password\"\n          type=\"password\"\n          autoComplete=\"new-password\"\n          required\n          isInvalid={!!errors.confirmPassword}\n          {...register(\"confirmPassword\", {\n            validate: (value) =>\n              value === passwordValue || \"The passwords do not match.\",\n          })}\n        ></Form.Control>\n\n        <Form.Control.Feedback type=\"invalid\">\n          {errors.password?.message}\n        </Form.Control.Feedback>\n        <Form.Control.Feedback type=\"invalid\">\n          {errors.confirmPassword?.message}\n        </Form.Control.Feedback>\n\n        {wrong ? (\n          <Form.Control.Feedback type=\"invalid\">\n            Please try again.\n          </Form.Control.Feedback>\n        ) : null}\n\n        <Form.Check\n          type=\"checkbox\"\n          className=\"mt-3\"\n          label=\"Agree to terms and privacy policy\"\n          id=\"accept-privacy-policy\"\n          defaultChecked\n        />\n      </LoginRegView>\n    </>\n  );\n}\n","import { Cart } from \"./cart\";\n\nexport enum OrderStatus {\n  submitted,\n  shipped,\n  delivered,\n  cancelled,\n}\n\nexport type Order = {\n  id: number;\n  datetime: string;\n  cart: Cart;\n  consignee: string;\n  status: OrderStatus;\n};\n\nexport function useOrders() {\n  const example: Order = {\n    id: 2021050100002333,\n    datetime: \"2021-05-01 09:41:05\",\n    cart: {\n      books: [\n        {\n          book: {\n            id: 1,\n            isbn: \"1\",\n            name: \"Java核心技术卷II\",\n            type: \"编程\",\n            author: \"凯S.霍斯特曼\",\n            price: 95.2,\n            description:\n              \"本书是Java领域有影响力和价值的著作之一，由拥有20多年教学与研究经验的Java技术专家撰写（获Jolt大奖），与《Java编程思想》齐名，10余年全球畅销不衰，广受好评。第10版根据JavaSE8全面更新，同时修正了第9版中的不足，系统全面讲解了Java语言的核心概念、语法、重要特性和开发方法，包含大量案例，实践性强。\",\n            inventory: 1000,\n            image: \"http://img3m9.ddimg.cn/12/36/1546133799-1_w_1.jpg\",\n          },\n          count: 1,\n        },\n        {\n          book: {\n            id: 4,\n            isbn: \"4\",\n            name: \"小王子\",\n            type: \"儿童文学\",\n            author: \"圣-埃克苏佩里\",\n            price: 8.89,\n            description:\n              \"豆瓣9.7高分推荐！旅法翻译家梅子涵之女梅思繁法文直译，舒朗大开本，央美教授高精度还原原作插画。首次收录全球舞台剧、音乐会、电影、动画片等对《小王子》的精彩诠释，通晓名作的前世今生。\",\n            inventory: 1000,\n            image: \"http://img3m9.ddimg.cn/75/6/25067469-1_u_2.jpg\",\n          },\n          count: 3,\n        },\n      ],\n      discount: 36.561,\n      total: 85.309,\n    },\n    consignee: \"Bugen Zhao\",\n    status: OrderStatus.delivered,\n  };\n\n  return [example, example];\n}\n","import { PropsWithChildren } from \"react\";\nimport { Table, Row } from \"react-bootstrap\";\nimport { Link } from \"react-router-dom\";\nimport { Header } from \"../components/Header\";\nimport { Order, useOrders } from \"../services/order\";\nimport { Body } from \"./common/Body\";\nimport { Main } from \"./common/Main\";\n\nexport function OrdersPage() {\n  return (\n    <Body>\n      <Header active=\"orders\" />\n      <Main>\n        <OrdersMain />\n      </Main>\n    </Body>\n  );\n}\n\nexport function OrderItem({\n  order,\n}: PropsWithChildren<{\n  order: Order;\n}>) {\n  const cartItems = order.cart.books.map((b) => (\n    <Row>\n      <Link to={`/detail/${b.book.id}`} className=\"d-flex nav-link\">\n        <span className=\"me-auto\">{b.book.name}</span>\n        <span className=\"text-muted\">x{b.count}</span>\n      </Link>\n    </Row>\n  ));\n\n  return (\n    <tr>\n      <td className=\"align-middle\">{order.id}</td>\n      <td className=\"align-middle\">{order.datetime}</td>\n      <td className=\"align-middle w-25\">{cartItems}</td>\n      <td className=\"align-middle\">¥{order.cart.total}</td>\n      <td className=\"align-middle\">{order.consignee}</td>\n      <td className=\"align-middle\">{order.status}</td>\n    </tr>\n  );\n}\n\nexport function OrdersMain() {\n  const orders = useOrders();\n\n  const orderItems = orders.map((order) => <OrderItem order={order} />);\n\n  return (\n    <>\n      <div className=\"h1 mb-4\">My Orders</div>\n      <Table responsive>\n        <thead>\n          <tr>\n            <th>#</th>\n            <th>Datetime</th>\n            <th>Items</th>\n            <th>Total Price</th>\n            <th>Consignee</th>\n            <th>Status</th>\n          </tr>\n        </thead>\n        <tbody>{orderItems}</tbody>\n      </Table>\n    </>\n  );\n}\n","import { PropsWithChildren } from \"react\";\nimport {\n  Route,\n  Switch,\n  HashRouter as Router,\n  Redirect,\n  RouteProps,\n} from \"react-router-dom\";\nimport {\n  CheckoutPage,\n  DetailPage,\n  HomePage,\n  SearchPage,\n  DashboardPage,\n  LoginPage,\n  RegisterPage,\n  OrdersPage,\n} from \"./pages\";\nimport { useUser } from \"./services/auth\";\n\nfunction SignedInRoute(props: PropsWithChildren<RouteProps>) {\n  const { error } = useUser();\n  if (error) {\n    return <Redirect to=\"/login\" />;\n  } else {\n    return <Route {...props}>{props.children}</Route>;\n  }\n}\n\nfunction AdminRoute(props: PropsWithChildren<RouteProps>) {\n  const isAdmin = useUser().isAdmin ?? true;\n  if (isAdmin) {\n    return <Route {...props}>{props.children}</Route>;\n  } else {\n    return <Redirect to=\"/home\" />;\n  }\n}\n\nexport function BSRoutes() {\n  return (\n    <Router>\n      <Switch>\n        <Route exact path=\"/\">\n          <Redirect to=\"/home\" />\n        </Route>\n        <Route path=\"/login\" component={LoginPage} />\n        <Route path=\"/register\" component={RegisterPage} />\n        <SignedInRoute path=\"/checkout\" component={CheckoutPage} />\n        <SignedInRoute path=\"/detail/:id\" component={DetailPage} />\n        <SignedInRoute path=\"/home\" component={HomePage} />\n        <SignedInRoute path=\"/search/:keyword?\" component={SearchPage} />\n        <SignedInRoute path=\"/orders\" component={OrdersPage} />\n        <AdminRoute path=\"/dashboard\" component={DashboardPage} />\n      </Switch>\n    </Router>\n  );\n}\n\nexport type DetailPageParams = {\n  id: string;\n};\n\nexport type SearchPageParams = {\n  keyword?: string;\n};\n","import { BSRoutes } from \"./routes\";\n\nimport { StoreProvider } from \"./services/StoreContext\";\n\nfunction App() {\n  return (\n    <StoreProvider>\n      <BSRoutes />\n    </StoreProvider>\n  );\n}\n\nexport default App;\n","import { ReportHandler } from \"web-vitals\";\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import(\"web-vitals\").then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\n\nimport \"bootstrap/dist/css/bootstrap.min.css\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}