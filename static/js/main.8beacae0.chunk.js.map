{"version":3,"sources":["services/StoreContext.tsx","config.ts","services/index.tsx","services/auth.tsx","services/cart.tsx","components/Header.tsx","pages/common/Main.tsx","pages/common/Body.tsx","views/CartView.tsx","views/PaymentView.tsx","views/AddressView.tsx","pages/CheckoutPage.tsx","components/BookCard.tsx","views/BookDetailView.tsx","services/book.tsx","pages/DetailPage.tsx","views/CarouselView.tsx","services/carousel.tsx","views/BooksView.tsx","pages/HomePage.tsx","views/LoginRegView.tsx","pages/LoginPage.tsx","pages/SearchPage.tsx","components/ErrorModal.tsx","utils/index.ts","services/admin.tsx","components/GridSortLabel.tsx","views/ManagementView.tsx","views/BookManagementView.tsx","views/UserManagementView.tsx","components/formatters.tsx","views/OrdersView.tsx","views/OrderManagementView.tsx","services/order.tsx","components/DatePicker.tsx","components/FromToPicker.tsx","views/SalesView.tsx","views/UserSpendingsView.tsx","pages/DashboardPage.tsx","pages/RegisterPage.tsx","views/OrdersSummaryView.tsx","pages/OrdersPage.tsx","routes.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["StoreContext","createContext","undefined","useStore","useContext","StoreProvider","props","useState","signedOut","setSignedOut","Provider","value","children","API_BASE","useFetch","path","config","fetcher","url","a","fetch","res","ok","json","useSWR","UserType","headers","post","body","method","put","delete_","patch","postLogin","data","JSON","stringify","postRegister","useAuth","r","isAdmin","error","user_type","admin","useCart","cartCount","_","books","map","b","count","sum","discount","total","Header","active","keyword","useRouteMatch","params","Navbar","bg","expand","className","Container","Brand","as","Link","to","Toggle","aria-controls","Collapse","id","Nav","Badge","pill","NavUserItem","SearchBox","initial","DashboardButton","history","useHistory","user","revalidate","OverlayTrigger","overlay","Tooltip","placement","onClick","push","username","inputRef","useRef","Form","onSubmit","input","current","length","FormControl","type","placeholder","defaultValue","ref","Button","variant","Main","py","Body","CartItem","book","link","ListGroup","Item","style","color","textDecoration","action","Row","Col","xs","Image","src","image","fluid","name","author","price","e","preventDefault","toString","Summary","title","textStyle","valuePrefix","toFixed","CartView","cartItems","PaymentContext","PaymentMethodItem","selected","setSelected","CreditCardForm","htmlFor","required","PaymentView","AddressContext","AddressItem","address","bgClass","tag","phone","AddNewAddressModal","modalShow","setModalShow","useForm","register","handleSubmit","Modal","show","size","onHide","backdrop","centered","closeButton","Title","alert","Group","Label","column","sm","Control","Check","label","Footer","form","AddNewAddressItem","AddressView","CheckoutMain","processing","setProcessing","noBook","disabled","result","CheckoutPage","BookCard","withLink","Card","Img","Subtitle","inventory","BookDetailView","height","isbn","classNames","description","ButtonGroup","useBooks","DetailPage","match","DetailMain","useBook","BreadCrumb","Spinner","animation","goBack","CarouselView","items","carousels","useCarousels","Carousel","alt","CarouselItem","triggerOnce","fade","Pagination","GalleryContext","page","setPage","totalPage","Math","ceil","pages","range","p","Books","setTotal","allBooks","allBooksIter","filter","values","join","includes","useEffect","booksThisPage","drop","take","cascade","damping","BooksView","HomePage","HomeMain","LoginRegTitle","isSignIn","select","primary","secondary","LoginRegView","isProcessing","LoginPage","banned","setBanned","wrong","setWrong","defaultValues","password","timeout","setTimeout","clearTimeout","Alert","status","trigger","delay","autoComplete","autoFocus","isInvalid","Feedback","Switch","defaultChecked","SearchPage","SearchMain","ErrorModal","encodeParams","Object","entries","kv","encodeURIComponent","defaultFrom","moment","subtract","duration","defaultTo","patchUser","patchBook","deleteBook","SortingIcon","direction","GridSortLabel","onSort","ManagementView","rows","cols","onCommitChanges","booleanCols","disableEditingCols","showAddCommand","showEditCommand","showDeleteCommand","editingStateColumnExtensions","col","columnName","editingEnabled","columns","getRowId","row","defaultCurrentPage","pageSize","defaultSorting","for","columnExtensions","showSortingControls","sortLabelComponent","BooleanFormatter","checked","BooleanEditor","onValueChange","onChange","target","BooleanTypeProvider","formatterComponent","editorComponent","BookManagementView","revalidateCart","k","titleize","errorShow","setErrorShow","errorResponse","setErrorResponse","statusText","added","changed","deleted","allPromises","promises","item","Promise","all","responses","failedOne","find","UserManagementView","users","useAllUsers","normal","DatetimeFormatter","datetime","format","OrdersView","orders","showUser","o","userShow","splice","filtering","predicate","dates","split","s","trim","curr","isSameOrAfter","isBefore","v","n","indexOf","quantity","defaultColumnWidths","width","OrderManagementView","useAllOrders","OrderStatus","DatePicker","shownDate","setShownDate","toDate","newDate","showTimeInput","showTimeSelect","dateFormat","FromToPicker","from","notify","controlId","md","lg","newFrom","newTo","SalesView","setFrom","setTo","sales","toISOString","useSales","counts","option","text","tooltip","axisPointer","grid","left","right","bottom","containLabel","xAxis","yAxis","reverse","series","ft","onEvents","click","UserSpendingsView","userSpendings","useUserSpendings","us","spendings","spending","u","responsive","DashboardPage","DashboardMain","tab","Tabs","activeKey","onSelect","replace","Tab","eventKey","RegisterPage","watch","errors","formState","passwordValue","email","pattern","message","minLength","confirmPassword","validate","OrdersSummaryView","summary","useOrdersSummary","totalCount","totalPrice","OrdersPage","OrdersMain","AllOrdersView","useOrders","SignedInRoute","AdminRoute","BSRoutes","exact","component","App","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.8beacae0.chunk.js","sourcesContent":["import { createContext, PropsWithChildren, useContext, useState } from \"react\";\nimport _ from \"lodash\";\n\ntype StoreContextType = {\n  signedOut: boolean;\n  setSignedOut: (s: boolean) => void;\n};\nexport const StoreContext = createContext<StoreContextType>(undefined!);\nexport function useStore() {\n  return useContext(StoreContext);\n}\n\nexport function StoreProvider(props: PropsWithChildren<{}>) {\n  const [signedOut, setSignedOut] = useState(false);\n\n  return (\n    <StoreContext.Provider\n      value={{\n        signedOut,\n        setSignedOut,\n      }}\n    >\n      {props.children}\n    </StoreContext.Provider>\n  );\n}\n","export const API_BASE = \"/api\";\n","\nimport useSWR, { SWRConfiguration } from \"swr\";\nimport { API_BASE } from \"../config\";\n\nexport type SelectContextType<T> = {\n  selected: T;\n  setSelected: (n: T) => void;\n};\n\nexport function useFetch<Data>(\n  path: string,\n  config?: SWRConfiguration<Data, any>\n) {\n  const fetcher = async (url: string) => {\n    const res = await fetch(url);\n    if (!res.ok) {\n      throw res;\n    }\n    return res.json();\n  };\n  const url = API_BASE + path;\n\n  return useSWR<Data, any>(url, fetcher, config);\n}\n\nconst headers = {\n  \"Content-type\": \"application/json; charset=UTF-8\",\n};\n\nexport function post(path: string, body?: BodyInit | null) {\n  const url = API_BASE + path;\n  return fetch(url, { method: \"POST\", body: body, headers: headers });\n}\n\nexport function put(path: string, body?: BodyInit | null) {\n  const url = API_BASE + path;\n  return fetch(url, { method: \"PUT\", body: body, headers: headers });\n}\n\nexport function delete_(path: string, body?: BodyInit | null) {\n  const url = API_BASE + path;\n  return fetch(url, { method: \"DELETE\", body: body, headers: headers });\n}\n\nexport function patch(path: string, body?: BodyInit | null) {\n  const url = API_BASE + path;\n  return fetch(url, { method: \"PATCH\", body: body, headers: headers });\n}\n","import { post, useFetch } from \".\";\n\nexport type LoginData = {\n  username: string;\n  password: string;\n};\n\nexport function postLogin(data: LoginData) {\n  return post(\"/users/login\", JSON.stringify(data));\n}\n\nexport function postLogout() {\n  return post(\"/users/logout\");\n}\n\nexport type RegisterData = {\n  username: string;\n  email: string;\n  password: string;\n};\n\nexport function postRegister(data: RegisterData) {\n  return post(\"/users/register\", JSON.stringify(data));\n}\n\nexport enum UserType {\n  admin = \"admin\",\n  normal = \"normal\",\n}\n\nexport type AuthedUser = {\n  user_id: number;\n  username: string;\n  user_type: UserType;\n};\n\nexport function useAuth() {\n  const r = useFetch<AuthedUser>(\"/users/check\");\n  const isAdmin =\n    r.data && !r.error ? r.data.user_type === UserType.admin : undefined;\n  return {\n    isAdmin,\n    ...r,\n  };\n}\n","import _ from \"lodash\";\nimport { delete_, post, put, useFetch } from \".\";\nimport { Book } from \"./book\";\n\nexport type Cart = {\n  books: { book: Book; count: number }[];\n  discount: number;\n  total: number;\n};\n\nexport function useCart() {\n  const r = useFetch<Cart>(\"/cart/\");\n  const cartCount =\n    r.data && !r.error\n      ? _(r.data.books)\n          .map((b) => b.count)\n          .sum()\n      : 0;\n  return {\n    books: (r.error ? undefined : r.data?.books) ?? [],\n    discount: (r.error ? undefined : r.data?.discount) ?? 0,\n    total: (r.error ? undefined : r.data?.total) ?? 0,\n    cartCount,\n    ...r,\n  };\n}\n\nexport function putCart(id: string) {\n  return put(`/cart/${id}`);\n}\n\nexport function deleteFromCart(id: string) {\n  return delete_(`/cart/${id}`);\n}\n\nexport function emptyCart() {\n  return delete_(\"/cart/\");\n}\n\nexport function checkout() {\n  return post(\"/cart/checkout\");\n}\n","import { useRef } from \"react\";\nimport { Bounce } from \"react-awesome-reveal\";\nimport {\n  Button,\n  OverlayTrigger,\n  Tooltip,\n  Nav,\n  Navbar,\n  Form,\n  FormControl,\n  Container,\n  Badge,\n} from \"react-bootstrap\";\nimport { Link, useHistory, useRouteMatch } from \"react-router-dom\";\nimport { SearchPageParams } from \"../routes\";\nimport { useStore } from \"../services/StoreContext\";\nimport _ from \"lodash\";\nimport { postLogout, useAuth } from \"../services/auth\";\nimport { useCart } from \"../services/cart\";\n\nexport function Header({\n  active,\n}: {\n  active: \"home\" | \"detail\" | \"search\" | \"cart\" | \"orders\" | \"dashboard\";\n}) {\n  const { cartCount } = useCart();\n  const isAdmin = useAuth().isAdmin ?? false;\n  const keyword = useRouteMatch<SearchPageParams>().params.keyword ?? \"\";\n\n  return (\n    <Navbar bg=\"white\" expand=\"lg\" className=\"shadow-sm fixed-top\">\n      <Container>\n        <Navbar.Brand className=\"fw-bolder\" as={Link} to=\"/home\">\n          Book Store\n        </Navbar.Brand>\n        <Navbar.Toggle aria-controls=\"basic-navbar-nav\" />\n        <Navbar.Collapse id=\"basic-navbar-nav\">\n          <Nav className=\"me-auto\">\n            <Nav.Link\n              as={Link}\n              to=\"/home\"\n              active={\n                active === \"home\" || active === \"detail\" || active === \"search\"\n              }\n            >\n              Books\n            </Nav.Link>\n            <Nav.Link as={Link} to=\"/checkout\" active={active === \"cart\"}>\n              <div className={`d-flex align-items-center`}>\n                <span className=\"me-1\">My Cart</span>\n                <Bounce>\n                  <Badge bg={cartCount === 0 ? \"secondary\" : \"danger\"} pill>\n                    {cartCount}\n                  </Badge>\n                </Bounce>\n              </div>\n            </Nav.Link>\n            <Nav.Link as={Link} to=\"/orders\" active={active === \"orders\"}>\n              My Orders\n            </Nav.Link>\n\n            <NavUserItem />\n          </Nav>\n\n          <SearchBox initial={keyword}></SearchBox>\n          {isAdmin ? <DashboardButton active={active} /> : null}\n        </Navbar.Collapse>\n      </Container>\n    </Navbar>\n  );\n}\n\nfunction NavUserItem() {\n  const { setSignedOut } = useStore();\n  const history = useHistory();\n  const { data: user, revalidate } = useAuth();\n\n  return (\n    <OverlayTrigger\n      overlay={<Tooltip id=\"signout-tooltip\">Click to sign out</Tooltip>}\n      placement=\"auto\"\n    >\n      <Nav.Link\n        onClick={async () => {\n          await postLogout();\n          await revalidate();\n          setSignedOut(true);\n          history.push(\"/login\");\n        }}\n      >\n        <span>Hi, </span>\n        <span className=\"fw-bold\">{user?.username ?? \"???\"}</span>\n      </Nav.Link>\n    </OverlayTrigger>\n  );\n}\n\nfunction SearchBox({ initial = \"\" }) {\n  const inputRef = useRef<HTMLInputElement>(null!);\n  const history = useHistory();\n\n  return (\n    <Form\n      className=\"d-flex mb-2 mb-lg-0\"\n      onSubmit={() => {\n        const input = inputRef.current.value;\n        if (input.length > 0) {\n          history.push(`/search/${input}`);\n        }\n      }}\n    >\n      <FormControl\n        className=\"form-control me-2\"\n        type=\"search\"\n        placeholder=\"Search Books...\"\n        defaultValue={initial}\n        ref={inputRef}\n      />\n      <Button variant=\"outline-secondary\" type=\"submit\">\n        Search\n      </Button>\n    </Form>\n  );\n}\n\nfunction DashboardButton({ active }: { active: string }) {\n  return (\n    <div className=\"ms-lg-2 d-flex\">\n      {active === \"dashboard\" ? (\n        <Button as={Link} to=\"/home\" variant=\"success\" className=\"w-100\">\n          Book Store\n        </Button>\n      ) : (\n        <Button\n          as={Link}\n          to=\"/dashboard\"\n          variant=\"primary\"\n          className=\"w-100\"\n        >\n          Dashboard\n        </Button>\n      )}\n    </div>\n  );\n}\n","import { PropsWithChildren } from \"react\";\n\nexport function Main({\n  py = 4,\n  children,\n}: PropsWithChildren<{\n  py?: number;\n}>) {\n  return <main className={`py-${py} container`}>{children}</main>;\n}\n","import { PropsWithChildren } from \"react\";\n\nexport function Body(props: PropsWithChildren<{}>) {\n  return <div className=\"store-home\">{props.children}</div>;\n}\n","import { PropsWithChildren } from \"react\";\nimport _ from \"lodash\";\nimport { Book } from \"../services/book\";\nimport { Link } from \"react-router-dom\";\nimport { Badge, Button, Col, Image, ListGroup, Row } from \"react-bootstrap\";\nimport { deleteFromCart, emptyCart, useCart } from \"../services/cart\";\n\nfunction CartItem({ book, count }: { book: Book; count: number }) {\n  const link = `/detail/${book.id}`;\n  const { revalidate } = useCart();\n\n  return (\n    <ListGroup.Item\n      as={Link}\n      to={link}\n      style={{ color: \"inherit\", textDecoration: \"inherit\" }}\n      action\n    >\n      <Row className=\"d-flex justify-content-between\">\n        <Col xs={3}>\n          <Image src={book.image} fluid></Image>\n        </Col>\n        <Col className=\"d-flex align-items-center\">\n          <div className=\"me-auto\">\n            <h6 className=\"mb-0\">{book.name}</h6>\n            <small className=\"text-muted\">{book.author}</small>\n          </div>\n          <div className=\"me-3\">\n            <span className=\"h5\">¥{book.price}</span>\n            {count > 1 ? <span className=\"text-muted\"> x{count}</span> : null}\n          </div>\n          <Badge\n            pill\n            as={Button}\n            variant=\"danger\"\n            onClick={async (e) => {\n              e.preventDefault();\n              await deleteFromCart(book.id.toString());\n              await revalidate();\n            }}\n          >\n            —\n          </Badge>\n        </Col>\n      </Row>\n    </ListGroup.Item>\n  );\n}\n\nfunction Summary({\n  title,\n  value,\n}: PropsWithChildren<{\n  title: \"Discount\" | \"Total\";\n  value: number;\n}>) {\n  const textStyle = title === \"Discount\" ? \"text-danger\" : \"fw-bold\";\n  const valuePrefix = title === \"Discount\" ? \"-¥\" : \"¥\";\n\n  return (\n    <ListGroup.Item>\n      <div className=\"d-flex justify-content-between align-items-center\">\n        <div>\n          <span className=\"h6\">{title}</span>\n        </div>\n        <div>\n          <span className={`h5 ${textStyle}`}>\n            {valuePrefix}\n            {value.toFixed(2)}\n          </span>\n        </div>\n      </div>\n    </ListGroup.Item>\n  );\n}\n\nexport function CartView() {\n  const { books, cartCount, discount, total, revalidate } = useCart();\n\n  const cartItems = _(books)\n    .map((b) => <CartItem book={b.book} count={b.count} key={b.book.id} />)\n    .value();\n\n  return (\n    <div>\n      <h4 className=\"d-flex align-items-center mb-3\">\n        <span className=\"text-muted me-2\">My cart</span>\n        <Badge pill bg=\"secondary\" className=\"me-auto\">\n          {cartCount}\n        </Badge>\n        {cartCount > 0 ? (\n          <Badge\n            pill\n            as={Button}\n            variant=\"danger\"\n            onClick={async () => {\n              await emptyCart();\n              await revalidate();\n            }}\n          >\n            Clear\n          </Badge>\n        ) : null}\n      </h4>\n      <ul className=\"list-group mb-3\">\n        {cartItems}\n        <Summary title=\"Discount\" value={discount} />\n        <Summary title=\"Total\" value={total} />\n      </ul>\n    </div>\n  );\n}\n","import { createContext, PropsWithChildren, useContext, useState } from \"react\";\nimport { SelectContextType } from \"../services\";\n\nconst PaymentContext = createContext<SelectContextType<string>>(null!);\n\ntype PaymentMethod = \"PayPal\" | \"WeChat Pay\" | \"Alipay\" | \"Credit card\";\n\nfunction PaymentMethodItem({\n  name,\n  children,\n}: PropsWithChildren<{\n  name: PaymentMethod;\n}>) {\n  const { selected, setSelected } = useContext(PaymentContext);\n\n  return (\n    <button\n      onClick={() => setSelected(name)}\n      className={`list-group-item list-group-item-action ${\n        selected === name ? \"active\" : \"\"\n      }`}\n    >\n      <div className=\"d-flex w-100 justify-content-between align-items-center\">\n        <span>{name}</span>\n        {children}\n      </div>\n    </button>\n  );\n}\n\nfunction CreditCardForm() {\n  return (\n    <div className=\"col\">\n      <div className=\"row gy-2\">\n        <div className=\"col-md-6\">\n          <label htmlFor=\"cc-name\" className=\"form-label\">\n            Name on card\n          </label>\n          <input\n            type=\"text\"\n            className=\"form-control\"\n            id=\"cc-name\"\n            placeholder=\"\"\n            required\n          />\n        </div>\n\n        <div className=\"col-md-6\">\n          <label htmlFor=\"cc-number\" className=\"form-label\">\n            Card number\n          </label>\n          <input\n            type=\"text\"\n            className=\"form-control\"\n            id=\"cc-number\"\n            placeholder=\"\"\n            required\n          />\n        </div>\n\n        <div className=\"col-md-6\">\n          <label htmlFor=\"cc-expiration\" className=\"form-label\">\n            Expiration\n          </label>\n          <input\n            type=\"text\"\n            className=\"form-control\"\n            id=\"cc-expiration\"\n            placeholder=\"\"\n            required\n          />\n        </div>\n\n        <div className=\"col-md-6\">\n          <label htmlFor=\"cc-cvv\" className=\"form-label\">\n            CVV\n          </label>\n          <input\n            type=\"text\"\n            className=\"form-control\"\n            id=\"cc-cvv\"\n            placeholder=\"\"\n            required\n          />\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport function PaymentView() {\n  const [selected, setSelected] = useState(\"Credit card\");\n\n  return (\n    <PaymentContext.Provider value={{ selected, setSelected }}>\n      <div>\n        <h4 className=\"mb-3\">Payment</h4>\n        <div className=\"row gy-2\">\n          <div className=\"col-lg-5 col-xxl-4\">\n            <div className=\"list-group\">\n              <PaymentMethodItem name=\"PayPal\" />\n              <PaymentMethodItem name=\"WeChat Pay\">\n                <span className=\"badge bg-success rounded-pill\">\n                  Recommended\n                </span>\n              </PaymentMethodItem>\n              <PaymentMethodItem name=\"Alipay\" />\n              <PaymentMethodItem name=\"Credit card\">\n                <span className=\"badge bg-secondary rounded-pill\">\n                  Last used\n                </span>\n              </PaymentMethodItem>\n            </div>\n          </div>\n\n          {selected === \"Credit card\" ? (\n            <CreditCardForm />\n          ) : (\n            <div className=\"col\">\n              You'll be redirected to {selected} after clicking \"Checkout\".\n            </div>\n          )}\n        </div>\n      </div>\n    </PaymentContext.Provider>\n  );\n}\n","import { createContext, useContext, useState } from \"react\";\nimport { Modal, Button, Form, Row, Col } from \"react-bootstrap\";\nimport { useForm } from \"react-hook-form\";\nimport { SelectContextType } from \"../services\";\n\ntype AddressContextType = SelectContextType<Address | undefined> & {\n  modalShow: boolean;\n  setModalShow: (b: boolean) => void;\n};\nconst AddressContext = createContext<AddressContextType>(undefined!);\n\nexport type NewAddressData = {\n  name: string;\n  phone: string;\n  address: string;\n};\n\nexport type Address = NewAddressData & {\n  id: number;\n  tag: string;\n};\n\nfunction AddressItem({ address }: { address: Address }) {\n  const bgClass = address.tag === \"Default\" ? \"bg-secondary\" : \"bg-success\";\n  const { selected, setSelected } = useContext(AddressContext);\n\n  return (\n    <button\n      onClick={() => setSelected(address)}\n      className={`list-group-item list-group-item-action ${\n        (selected?.id ?? 0) === address.id ? \"active\" : \"\"\n      }`}\n    >\n      <div className=\"d-flex w-100 justify-content-between align-items-center\">\n        <h5 className=\"mb-1\">{address.name}</h5>\n        <span className={`badge ${bgClass} rounded-pill`}>{address.tag}</span>\n      </div>\n      <p className=\"mb-0 small\">{address.phone}</p>\n      <p className=\"mb-0\">{address.address}</p>\n    </button>\n  );\n}\n\nfunction AddNewAddressModal() {\n  const { modalShow, setModalShow } = useContext(AddressContext);\n  const { register, handleSubmit } = useForm<NewAddressData>();\n\n  return (\n    <Modal\n      show={modalShow}\n      size=\"lg\"\n      onHide={() => setModalShow(false)}\n      backdrop=\"static\"\n      centered\n    >\n      <Modal.Header closeButton>\n        <Modal.Title>Add a New Address</Modal.Title>\n      </Modal.Header>\n      <Modal.Body>\n        <Form\n          onSubmit={handleSubmit((data) => {\n            alert(JSON.stringify(data));\n            setModalShow(false);\n          })}\n          id=\"add-new-address-form\"\n        >\n          <Form.Group as={Row} className=\"mb-3\">\n            <Form.Label column sm={3}>\n              Name\n            </Form.Label>\n            <Col sm={9}>\n              <Form.Control\n                placeholder=\"Enter full name\"\n                required\n                {...register(\"name\")}\n              />\n            </Col>\n          </Form.Group>\n\n          <Form.Group as={Row} className=\"mb-3\">\n            <Form.Label column sm={3}>\n              Phone Number\n            </Form.Label>\n            <Col sm={9}>\n              <Form.Control\n                placeholder=\"Enter phone number\"\n                required\n                {...register(\"phone\")}\n              />\n            </Col>\n          </Form.Group>\n\n          <Form.Group as={Row} className=\"mb-3\">\n            <Form.Label column sm={3}>\n              Address\n            </Form.Label>\n            <Col sm={9}>\n              <Form.Control\n                as=\"textarea\"\n                placeholder=\"Enter address\"\n                required\n                {...register(\"address\")}\n              />\n            </Col>\n          </Form.Group>\n\n          <Form.Group className=\"mb-3\">\n            <Form.Check\n              type=\"checkbox\"\n              label=\"Set as default\"\n              id=\"set-as-default\"\n            />\n          </Form.Group>\n        </Form>\n      </Modal.Body>\n      <Modal.Footer>\n        <Button variant=\"primary\" type=\"submit\" form=\"add-new-address-form\">\n          Confirm\n        </Button>\n      </Modal.Footer>\n    </Modal>\n  );\n}\n\nfunction AddNewAddressItem() {\n  const { setModalShow } = useContext(AddressContext);\n  return (\n    <>\n      <button\n        className=\"list-group-item list-group-item-action\"\n        onClick={() => setModalShow(true)}\n      >\n        <span className=\"text-muted\">Add a new address...</span>\n      </button>\n    </>\n  );\n}\n\nexport function AddressView() {\n  const [selected, setSelected] = useState<Address>();\n  const [modalShow, setModalShow] = useState(false);\n\n  return (\n    <AddressContext.Provider\n      value={{ selected, setSelected, modalShow, setModalShow }}\n    >\n      <div>\n        <h4 className=\"mb-3\">Shipping Address</h4>\n        <div>\n          <div className=\"list-group\">\n            <AddressItem\n              address={{\n                id: 0,\n                name: \"Bugen Zhao\",\n                tag: \"Default\",\n                phone: \"+86 155 2121 2121\",\n                address: \"1234 Main St., Minhang, Shanghai, China\",\n              }}\n            />\n            <AddressItem\n              address={{\n                id: 1,\n                name: \"Alice Cook\",\n                tag: \"Home\",\n                phone: \"+1 802 812 3456\",\n                address: \"4321 Home St., Cupertino, CA, United States\",\n              }}\n            />\n            <AddressItem\n              address={{\n                id: 2,\n                name: \"Dave Jobs\",\n                tag: \"School\",\n                phone: \"+86 188 1234 5678\",\n                address: \"9876 School St., Shanghai, China\",\n              }}\n            />\n            <AddNewAddressItem />\n            <AddNewAddressModal />\n          </div>\n        </div>\n      </div>\n    </AddressContext.Provider>\n  );\n}\n","import { Header } from \"../components/Header\";\nimport { Main } from \"./common/Main\";\nimport { Body } from \"./common/Body\";\nimport { CartView } from \"../views/CartView\";\nimport { PaymentView } from \"../views/PaymentView\";\nimport { AddressView } from \"../views/AddressView\";\nimport { Fade } from \"react-awesome-reveal\";\nimport { checkout, useCart } from \"../services/cart\";\nimport { Modal, OverlayTrigger, Tooltip } from \"react-bootstrap\";\nimport { useState } from \"react\";\nimport { Link } from \"react-router-dom\";\n\nfunction CheckoutMain() {\n  const { cartCount, revalidate } = useCart();\n  const [modalShow, setModalShow] = useState<\"no\" | \"success\" | \"failed\">(\"no\");\n  const [processing, setProcessing] = useState(false);\n\n  const noBook = cartCount === 0;\n\n  return (\n    <div>\n      <Modal\n        show={modalShow !== \"no\"}\n        onHide={() => {\n          setModalShow(\"no\");\n          setProcessing(false);\n        }}\n      >\n        <Modal.Header closeButton>\n          <Modal.Title>\n            {modalShow === \"success\" ? \"Checkout Success\" : \"Checkout Failed\"}\n          </Modal.Title>\n        </Modal.Header>\n\n        <Modal.Body>\n          {modalShow === \"success\" ? (\n            <>\n              Go to <Link to=\"/orders\">My Orders</Link> to check the order.\n            </>\n          ) : (\n            \"There is not enough stock of some books in your cart.\"\n          )}\n        </Modal.Body>\n      </Modal>\n      <div className=\"row\">\n        <div className=\"col-md-6 col-lg-5 order-md-last\">\n          <CartView />\n        </div>\n        <div className=\"col-md-6 col-lg-7\">\n          <AddressView />\n          <hr className=\"my-4\" />\n          <PaymentView />\n          <hr className=\"my-4\" />\n          <div className=\"d-flex justify-content-end\">\n            <OverlayTrigger\n              overlay={\n                <Tooltip id=\"no-book-tooltip\">\n                  There's no book in the cart\n                </Tooltip>\n              }\n              placement=\"bottom\"\n              show={noBook}\n            >\n              <button\n                className=\"btn btn-primary btn-lg col-12 col-lg-3\"\n                type=\"submit\"\n                disabled={processing || noBook}\n                onClick={async () => {\n                  setProcessing(true);\n                  const result = await checkout();\n                  await revalidate();\n                  if (result.ok) {\n                    setModalShow(\"success\");\n                  } else {\n                    setModalShow(\"failed\");\n                  }\n                  setProcessing(false);\n                }}\n              >\n                {processing ? \"Processing...\" : \"Checkout\"}\n              </button>\n            </OverlayTrigger>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport function CheckoutPage() {\n  return (\n    <Body>\n      <Header active=\"cart\" />\n      <Main py={5}>\n        <Fade>\n          <CheckoutMain />\n        </Fade>\n      </Main>\n    </Body>\n  );\n}\n","import { Card } from \"react-bootstrap\";\nimport { Link } from \"react-router-dom\";\nimport { Book } from \"../services/book\";\n\nexport function BookCard({\n  book,\n  withLink = true,\n}: {\n  book: Book;\n  withLink: boolean;\n}) {\n  const path = `/detail/${book.id}`;\n\n  return (\n    <Card>\n      {withLink ? (\n        <Card.Link className=\"stretched-link\" as={Link} to={path} />\n      ) : null}\n      <Card.Img variant=\"top\" src={book.image} />\n      <Card.Body>\n        <Card.Title className=\"text-truncate\">{book.name}</Card.Title>\n        <div className=\"d-flex justify-content-between align-items-center\">\n          <Card.Subtitle className=\"text-danger\" as=\"h6\">\n            ¥{book.price}\n          </Card.Subtitle>\n          <Card.Subtitle className=\"text-muted\" as=\"small\">\n            {book.inventory}\n          </Card.Subtitle>\n        </div>\n      </Card.Body>\n    </Card>\n  );\n}\n","import classNames from \"classnames\";\nimport { ButtonGroup, Button } from \"react-bootstrap\";\nimport { Link } from \"react-router-dom\";\nimport { Book } from \"../services/book\";\nimport { putCart, useCart } from \"../services/cart\";\n\nexport function BookDetailView({ book }: { book: Book }) {\n  const { revalidate } = useCart();\n\n  return (\n    <div\n      className=\"d-flex flex-column justify-content-between\"\n      style={{ height: \"100%\" }}\n    >\n      <div>\n        <h1 className=\"h2 my-3\">{book.name}</h1>\n        <div className=\"mb-3\">\n          <dl className=\"row\">\n            <dt className=\"col-sm-3\">Author</dt>\n            <dd className=\"col-sm-9\">{book.author}</dd>\n\n            <dt className=\"col-sm-3\">Press</dt>\n            <dd className=\"col-sm-9\">Unknown Press</dd>\n\n            <dt className=\"col-sm-3\">ISBN</dt>\n            <dd className=\"col-sm-9\">{book.isbn}</dd>\n\n            <dt className=\"col-sm-3\">Category</dt>\n            <dd className=\"col-sm-9\">{book.type}</dd>\n\n            <dt className=\"col-sm-3\">Stock</dt>\n            <dd\n              className={classNames(\"col-sm-9\", {\n                \"text-danger\": book.inventory === 0,\n              })}\n            >\n              {book.inventory}\n            </dd>\n\n            <dt className=\"col-sm-3\">Price</dt>\n            <dd className=\"col-sm-9 text-danger fw-bold\">¥{book.price}</dd>\n\n            <dt className=\"col-sm-3\">Introduction</dt>\n            <dd className=\"col-sm-9\">{book.description}</dd>\n          </dl>\n        </div>\n      </div>\n      <div className=\"my-3\">\n        <div className=\"d-flex justify-content-end\">\n          <ButtonGroup className=\"col-12 col-xl-6 col-lg-8\" size=\"lg\">\n            <Button\n              variant=\"outline-danger\"\n              className=\"w-100\"\n              disabled={book.inventory === 0}\n              onClick={async () => {\n                await putCart(book.id.toString());\n                await revalidate();\n              }}\n            >\n              Add to Cart\n            </Button>\n            <Button\n              variant=\"outline-danger\"\n              className=\"w-100\"\n              as={Link}\n              to=\"/checkout\"\n            >\n              Checkout\n            </Button>\n          </ButtonGroup>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { useFetch } from \".\";\n\nexport type Book = {\n  id: number;\n  isbn: string;\n  name: string;\n  type: string;\n  author: string;\n  price: number;\n  description: string;\n  inventory: number;\n  image: string;\n};\n\nexport type BookDict = Record<string, Book>;\n\nexport function useBook(id: string) {\n  const r = useFetch<Book>(`/books/${id}`);\n  return {\n    book: r.error ? undefined : r.data,\n    ...r,\n  };\n}\n\nexport function useBooks() {\n  const r = useFetch<BookDict>(`/books/`);\n  return {\n    books: r.error ? undefined : r.data,\n    ...r,\n  };\n}\n","import { Link, RouteComponentProps, useHistory } from \"react-router-dom\";\nimport { BookCard } from \"../components/BookCard\";\nimport { Header } from \"../components/Header\";\nimport { BookDetailView } from \"../views/BookDetailView\";\nimport { Main } from \"./common/Main\";\nimport { Body } from \"./common/Body\";\nimport { Fade } from \"react-awesome-reveal\";\nimport { Row, Spinner } from \"react-bootstrap\";\nimport { useBook } from \"../services/book\";\n\nexport function DetailPage(\n  props: RouteComponentProps<{\n    id: string;\n  }>\n) {\n  const id = props.match.params.id;\n\n  return (\n    <Body>\n      <Header active=\"detail\" />\n      <Main py={5}>\n        <DetailMain id={id} />\n      </Main>\n    </Body>\n  );\n}\n\nfunction DetailMain({ id }: { id: string }) {\n  const { book } = useBook(id);\n\n  if (!book) {\n    return (\n      <div>\n        <BreadCrumb />\n        <Row className=\"justify-content-center mt-5\">\n          <Spinner animation=\"border\" variant=\"primary\" />\n        </Row>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <BreadCrumb name={book.name} />\n      <Fade>\n        <Row>\n          <div className=\"col-md-5 col-lg-4 align-self-center\">\n            <BookCard book={book} withLink={false} />\n          </div>\n          <div className=\"col-md-7 col-lg-8\">\n            <BookDetailView book={book} />\n          </div>\n        </Row>\n      </Fade>\n    </div>\n  );\n}\n\nfunction BreadCrumb({ name }: { name?: string }) {\n  const history = useHistory();\n\n  return (\n    <nav>\n      <ol className=\"breadcrumb h6\">\n        <li className=\"breadcrumb-item\">\n          <Link to=\"#\" className=\"\" onClick={() => history.goBack()}>\n            ⬅ Go Back\n          </Link>\n        </li>\n        {name ? (\n          <li className=\"breadcrumb-item active\">{name}</li>\n        ) : (\n          <li className=\"breadcrumb-item\">...</li>\n        )}\n      </ol>\n    </nav>\n  );\n}\n","import { Fade } from \"react-awesome-reveal\";\nimport { Carousel } from \"react-bootstrap\";\nimport { useCarousels } from \"../services/carousel\";\n\nfunction CarouselItem(url: string) {\n  return (\n    <Carousel.Item key={url}>\n      <img className=\"d-block w-100\" src={url} alt={url} />\n    </Carousel.Item>\n  );\n}\n\nexport function CarouselView() {\n  const paths = useCarousels().carousels;\n  const items = paths.map((url) => CarouselItem(url));\n\n  return (\n    <Fade triggerOnce>\n      <Carousel className=\"mb-4\" fade>\n        {items}\n      </Carousel>\n    </Fade>\n  );\n}\n","import { useFetch } from \".\";\n\nexport function useCarousels() {\n  const r = useFetch<string[]>(\"/carousels/\");\n  return {\n    carousels: (r.error ? undefined : r.data) ?? [],\n    ...r,\n  };\n}\n","import { createContext, useContext, useEffect, useState } from \"react\";\nimport { useRouteMatch } from \"react-router-dom\";\nimport _ from \"lodash\";\nimport { BookCard } from \"../components/BookCard\";\nimport { SearchPageParams } from \"../routes\";\nimport { Fade } from \"react-awesome-reveal\";\nimport { Row, Spinner } from \"react-bootstrap\";\nimport { useBooks } from \"../services/book\";\n\nconst PER_PAGE = 12;\n\nfunction Pagination() {\n  const { total, page, setPage } = useContext(GalleryContext);\n  const totalPage = Math.ceil(total / PER_PAGE);\n\n  const pages = _(_.range(1, totalPage + 1))\n    .map((p) => (\n      <li className={`page-item ${p === page ? \"active\" : \"\"}`} key={p}>\n        <button className=\"page-link\" onClick={() => setPage(p)}>\n          {p}\n        </button>\n      </li>\n    ))\n    .value();\n\n  return (\n    <div className=\"py-5\" id=\"footer\">\n      <nav>\n        <ul className=\"pagination justify-content-center\">\n          <li className={`page-item ${page === 1 ? \"disabled\" : \"\"}`}>\n            <button className=\"page-link\" onClick={() => setPage(page - 1)}>\n              Previous\n            </button>\n          </li>\n          {pages}\n          <li className={`page-item ${page === totalPage ? \"disabled\" : \"\"}`}>\n            <button className=\"page-link\" onClick={() => setPage(page + 1)}>\n              Next\n            </button>\n          </li>\n        </ul>\n      </nav>\n    </div>\n  );\n}\n\nfunction Books() {\n  const { setTotal, page } = useContext(GalleryContext);\n  const keyword = useRouteMatch<SearchPageParams>().params.keyword ?? \"\";\n  const { books: allBooks } = useBooks();\n\n  const allBooksIter = _(allBooks).filter((book) =>\n    _(book).values().join().includes(keyword)\n  );\n  useEffect(() => setTotal(allBooksIter.size()));\n\n  if (!allBooks) {\n    return (\n      <Row className=\"justify-content-center mt-5\">\n        <Spinner animation=\"border\" variant=\"primary\" />\n      </Row>\n    );\n  }\n\n  const booksThisPage = allBooksIter\n    .map((book) => (\n      <div key={`book${book.id}`} className=\"col\">\n        <BookCard book={book} withLink />\n      </div>\n    ))\n    .drop((page - 1) * PER_PAGE)\n    .take(PER_PAGE)\n    .value();\n\n  return (\n    <div\n      className=\"row row-cols-2 row-cols-md-3 row-cols-lg-4 row-cols-xl-5 row-cols-xxl-6 g-3\"\n      id=\"books\"\n    >\n      <Fade cascade damping={0.025} triggerOnce>\n        {booksThisPage}\n      </Fade>\n    </div>\n  );\n}\n\ntype GalleryContextType = {\n  total: number;\n  setTotal: (n: number) => void;\n  page: number;\n  setPage: (n: number) => void;\n};\n\nconst GalleryContext = createContext<GalleryContextType>(null!);\n\nexport function BooksView() {\n  const [total, setTotal] = useState(0);\n  const [page, setPage] = useState(1);\n\n  return (\n    <GalleryContext.Provider value={{ total, setTotal, page, setPage }}>\n      <div>\n        <Books />\n        <Pagination />\n      </div>\n    </GalleryContext.Provider>\n  );\n}\n","import { Header } from \"../components/Header\";\nimport { CarouselView } from \"../views/CarouselView\";\nimport { BooksView } from \"../views/BooksView\";\nimport { Main } from \"./common/Main\";\nimport { Body } from \"./common/Body\";\n\nexport function HomePage() {\n  return (\n    <Body>\n      <Header active=\"home\" />\n      <Main>\n        <HomeMain />\n      </Main>\n    </Body>\n  );\n}\n\nfunction HomeMain() {\n  return (\n    <div>\n      <CarouselView />\n      <BooksView />\n    </div>\n  );\n}\n","import { PropsWithChildren } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport { Fade } from \"react-awesome-reveal\";\nimport { Button } from \"react-bootstrap\";\n\nfunction LoginRegTitle({\n  isSignIn,\n}: PropsWithChildren<{\n  isSignIn: boolean;\n}>) {\n  const select = (b: boolean) => (b ? \"Sign in\" : \"Sign up\");\n  const primary = select(isSignIn);\n  const secondary = select(!isSignIn);\n  const link = isSignIn ? \"/register\" : \"/login\";\n\n  return (\n    <>\n      <h1 className=\"mb-3\">\n        <span className=\"h1 fw-bold\">{primary}</span>\n        <span className=\"h4\"> / </span>\n        <Link className=\"h5 fw-bold text-muted\" to={link}>\n          {secondary}\n        </Link>\n      </h1>\n    </>\n  );\n}\n\nexport function LoginRegView({\n  isSignIn,\n  children,\n  onSubmit,\n  isProcessing,\n}: PropsWithChildren<{\n  isSignIn: boolean;\n  onSubmit: () => void;\n  isProcessing: boolean;\n}>) {\n  return (\n    <>\n      <main className=\"form-signin\">\n        <Fade>\n          <LoginRegTitle isSignIn={isSignIn} />\n          <form onSubmit={onSubmit}>\n            {children}\n            <Button\n              className=\"w-100 mt-3\"\n              variant=\"dark\"\n              size=\"lg\"\n              type=\"submit\"\n              disabled={isProcessing}\n            >\n              {isProcessing ? \"Signing \" : \"Sign \"}\n              {isSignIn ? \"in\" : \"up\"}\n              {isProcessing ? \"...\" : \"\"}\n            </Button>\n          </form>\n        </Fade>\n      </main>\n    </>\n  );\n}\n","import { useEffect, useState } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport { useStore } from \"../services/StoreContext\";\nimport { Alert, Form, OverlayTrigger } from \"react-bootstrap\";\nimport { LoginRegView } from \"../views/LoginRegView\";\nimport { useForm } from \"react-hook-form\";\nimport { useAuth } from \"../services/auth\";\nimport { LoginData, postLogin } from \"../services/auth\";\n\ntype LoginFormData = LoginData;\n\nexport function LoginPage() {\n  const { signedOut, setSignedOut } = useStore();\n  const { revalidate } = useAuth();\n  const history = useHistory();\n  const [banned, setBanned] = useState(false);\n  const [processing, setProcessing] = useState(false);\n  const [wrong, setWrong] = useState(false);\n\n  const { register, handleSubmit } = useForm<LoginFormData>({\n    defaultValues: {\n      username: \"thunderboy\",\n      password: \"reins1409\",\n    },\n  });\n\n  useEffect(() => {\n    const timeout = setTimeout(() => {\n      setSignedOut(false);\n      setBanned(false);\n    }, 5000);\n\n    return () => {\n      clearTimeout(timeout);\n      setSignedOut(false);\n    };\n  }, [setSignedOut, banned]);\n\n  return (\n    <>\n      <Alert show={signedOut} variant=\"primary\" className=\"text-center h5\">\n        You have signed out.\n      </Alert>\n      <Alert show={banned} variant=\"danger\" className=\"text-center h5\">\n        Your account has been banned by administrators.\n      </Alert>\n      <LoginRegView\n        isSignIn\n        onSubmit={handleSubmit(async (data) => {\n          setProcessing(true);\n          setWrong(false);\n          const res = await postLogin(data);\n          await revalidate();\n          setProcessing(false);\n          if (res.ok) {\n            setSignedOut(false);\n            history.push(\"/home\");\n          } else if (res.status === 403) {\n            setBanned(true);\n          } else {\n            setWrong(true);\n          }\n        })}\n        isProcessing={processing}\n      >\n        <OverlayTrigger\n          placement=\"bottom-end\"\n          trigger=\"focus\"\n          delay={300}\n          overlay={\n            // <Tooltip id=\"user-tooltip\">\n            //   Sign in as <strong>{ADMINS.join(\" or \")}</strong> to obtain the\n            //   admin permissions.\n            // </Tooltip>\n            <div />\n          }\n        >\n          <Form.Control\n            className=\"input-first\"\n            placeholder=\"Username\"\n            autoComplete=\"username\"\n            required\n            autoFocus\n            isInvalid={wrong}\n            {...register(\"username\")}\n          />\n        </OverlayTrigger>\n        <Form.Control\n          className=\"input-last\"\n          placeholder=\"Password\"\n          type=\"password\"\n          required\n          isInvalid={wrong}\n          {...register(\"password\")}\n        ></Form.Control>\n\n        {wrong ? (\n          <Form.Control.Feedback type=\"invalid\">\n            Please try again.\n          </Form.Control.Feedback>\n        ) : null}\n\n        <Form.Switch className=\"mt-3\" label=\"Remember me\" defaultChecked />\n      </LoginRegView>\n    </>\n  );\n}\n","import { Header } from \"../components/Header\";\nimport { BooksView } from \"../views/BooksView\";\nimport { Main } from \"./common/Main\";\nimport { Body } from \"./common/Body\";\nimport { useRouteMatch } from \"react-router\";\nimport { SearchPageParams } from \"../routes\";\n\nexport function SearchPage() {\n  return (\n    <Body>\n      <Header active=\"search\" />\n      <Main>\n        <SearchMain />\n      </Main>\n    </Body>\n  );\n}\n\nfunction SearchMain() {\n  const keyword = useRouteMatch<SearchPageParams>().params.keyword ?? \"\";\n\n  return (\n    <div>\n      <div className=\"py-5\">\n        <span className=\"h1\">Search Results for \"{keyword}\"</span>\n      </div>\n      <BooksView />\n    </div>\n  );\n}\n","import { PropsWithChildren, ReactNode } from \"react\";\nimport { Modal, Button } from \"react-bootstrap\";\n\nexport function ErrorModal({\n  modalShow,\n  setModalShow,\n  title = \"Error\",\n  children,\n}: PropsWithChildren<{\n  modalShow: boolean;\n  setModalShow: (b: boolean) => void;\n  title?: ReactNode;\n}>) {\n  return (\n    <Modal\n      show={modalShow}\n      onHide={() => setModalShow(false)}\n      backdrop=\"static\"\n      centered\n    >\n      <Modal.Header closeButton>\n        <Modal.Title>{title}</Modal.Title>\n      </Modal.Header>\n      <Modal.Body>{children}</Modal.Body>\n      <Modal.Footer>\n        <Button variant=\"primary\" onClick={() => setModalShow(false)}>\n          OK\n        </Button>\n      </Modal.Footer>\n    </Modal>\n  );\n}\n","import moment, { duration } from \"moment\";\n\nexport function encodeParams(p: Record<string, any>) {\n  return Object.entries(p)\n    .map((kv) => kv.map(encodeURIComponent).join(\"=\"))\n    .join(\"&\");\n}\n\nexport const defaultFrom = () => moment().subtract(duration(7, \"days\"));\nexport const defaultTo = () => moment();\n","import { Moment } from \"moment\";\nimport { delete_, patch, put, useFetch } from \".\";\nimport { encodeParams } from \"../utils\";\nimport { UserType } from \"./auth\";\nimport { Book } from \"./book\";\nimport { Order } from \"./order\";\n\nexport type User = {\n  id: string;\n  username: string;\n  email: string;\n  type: UserType;\n  banned: boolean;\n};\n\nexport function useAllUsers() {\n  const r = useFetch<Record<string, User>>(\"/admin/users/\");\n  return {\n    users: r.error ? undefined : r.data,\n    ...r,\n  };\n}\n\nexport function patchUser(id: string, data: Partial<User>) {\n  return patch(`/admin/users/${id}`, JSON.stringify(data));\n}\n\nexport function patchBook(id: string, data: Partial<Book>) {\n  return patch(`/admin/books/${id}`, JSON.stringify(data));\n}\n\nexport function putBook(data: Partial<Book>) {\n  return put(`/admin/books/`, JSON.stringify(data));\n}\n\nexport function deleteBook(id: string) {\n  return delete_(`/admin/books/${id}`);\n}\n\nexport function useAllOrders() {\n  const r = useFetch<Order[]>(\"/admin/orders/\");\n  return {\n    orders: (r.error ? undefined : r.data) ?? [],\n    ...r,\n  };\n}\n\nexport type Sales = {\n  book: Book;\n  count: number;\n}[];\n\nexport function useSales(from: Moment | undefined, to: Moment | undefined) {\n  const r = useFetch<Sales>(\n    \"/admin/stat/sales?\" +\n      encodeParams({\n        from: from?.toISOString(),\n        to: to?.toISOString(),\n      })\n  );\n  return {\n    sales: r.error ? undefined : r.data,\n    ...r,\n  };\n}\n\nexport type UserSpendings = {\n  user: User;\n  spending: number;\n}[];\n\nexport function useUserSpendings(\n  from: Moment | undefined,\n  to: Moment | undefined\n) {\n  const r = useFetch<UserSpendings>(\n    \"/admin/stat/spendings?\" +\n      encodeParams({\n        from: from?.toISOString(),\n        to: to?.toISOString(),\n      })\n  );\n  return {\n    userSpendings: r.error ? undefined : r.data,\n    ...r,\n  };\n}\n","import { FC } from \"react\";\nimport { TableHeaderRow } from \"@devexpress/dx-react-grid-bootstrap4\";\nimport { ArrowDown, ArrowUp } from \"react-bootstrap-icons\";\nimport { Button } from \"react-bootstrap\";\n\nconst SortingIcon = ({ direction }: { direction: \"asc\" | \"desc\" }) =>\n  direction === \"asc\" ? <ArrowUp /> : <ArrowDown />;\n\nexport const GridSortLabel: FC<TableHeaderRow.SortLabelProps> = ({\n  onSort,\n  children,\n  direction,\n}) => (\n  <Button variant=\"light\" onClick={() => onSort({})}>\n    <span className=\"fw-bold\">{children}</span>\n    {direction && <SortingIcon direction={direction} />}\n  </Button>\n);\n","import {\n  EditingState,\n  PagingState,\n  IntegratedPaging,\n  ChangeSet,\n  SearchState,\n  IntegratedFiltering,\n  SortingState,\n  IntegratedSorting,\n  DataTypeProvider,\n  DataTypeProviderProps,\n} from \"@devexpress/dx-react-grid\";\nimport {\n  Grid,\n  Table,\n  TableHeaderRow,\n  TableEditRow,\n  TableEditColumn,\n  PagingPanel,\n  SearchPanel,\n  Toolbar,\n} from \"@devexpress/dx-react-grid-bootstrap4\";\nimport { PropsWithChildren, useRef } from \"react\";\nimport { Form } from \"react-bootstrap\";\nimport { GridSortLabel } from \"../components/GridSortLabel\";\n\nexport type Col<R> = keyof R & string;\nexport type DisplayCol<R> = {\n  name: Col<R>;\n  title: string;\n};\nexport type Patch<R> = Partial<Record<Col<R>, any>>;\n\nexport function ManagementView<R>({\n  rows,\n  cols,\n  onCommitChanges,\n  booleanCols,\n  disableEditingCols = [\"id\"],\n  showAddCommand = false,\n  showEditCommand = false,\n  showDeleteCommand = false,\n}: PropsWithChildren<{\n  rows: R[];\n  cols: DisplayCol<R>[];\n  onCommitChanges: ({\n    added,\n    changed,\n    deleted,\n  }: {\n    added?: readonly Patch<R>[];\n    changed?: Record<string, Patch<R> | undefined>;\n    deleted?: ChangeSet[\"deleted\"];\n  }) => void;\n  booleanCols?: string[];\n  disableEditingCols?: string[];\n  showAddCommand?: boolean;\n  showEditCommand?: boolean;\n  showDeleteCommand?: boolean;\n}>) {\n  const editingStateColumnExtensions = useRef(\n    disableEditingCols.map((col) => {\n      return { columnName: col, editingEnabled: false };\n    })\n  );\n\n  return (\n    <div className=\"card\">\n      <Grid rows={rows} columns={cols} getRowId={(row) => row.id}>\n        <SearchState />\n        <IntegratedFiltering />\n        <PagingState defaultCurrentPage={0} pageSize={50} />\n        <IntegratedPaging />\n        <SortingState\n          defaultSorting={[{ columnName: \"id\", direction: \"asc\" }]}\n        />\n        <IntegratedSorting />\n        <BooleanTypeProvider for={booleanCols ?? []} />\n        <EditingState\n          onCommitChanges={onCommitChanges}\n          columnExtensions={editingStateColumnExtensions.current}\n        />\n        <Table />\n        <TableHeaderRow\n          showSortingControls\n          sortLabelComponent={GridSortLabel}\n        />\n        <TableEditRow />\n        <TableEditColumn\n          showAddCommand={showAddCommand}\n          showEditCommand={showEditCommand}\n          showDeleteCommand={showDeleteCommand}\n        />\n        <Toolbar />\n        <SearchPanel />\n        <PagingPanel />\n      </Grid>\n    </div>\n  );\n}\n\nconst BooleanFormatter = ({ value }: { value: boolean }) => (\n  <Form.Check type=\"checkbox\" checked={value} disabled />\n);\n\nconst BooleanEditor = ({\n  value,\n  onValueChange,\n}: {\n  value: boolean;\n  onValueChange: (b: boolean) => void;\n}) => (\n  <Form.Check\n    type=\"checkbox\"\n    defaultChecked={value}\n    onChange={(e) => onValueChange(e.target.checked)}\n  />\n);\n\nconst BooleanTypeProvider = ({ for: booleanCols }: DataTypeProviderProps) => (\n  <DataTypeProvider\n    formatterComponent={BooleanFormatter}\n    editorComponent={BooleanEditor}\n    for={booleanCols}\n  />\n);\n","import \"@devexpress/dx-react-grid-bootstrap4/dist/dx-react-grid-bootstrap4.css\";\nimport _ from \"lodash\";\nimport { useState } from \"react\";\nimport titleize from \"titleize\";\nimport { ErrorModal } from \"../components/ErrorModal\";\nimport { deleteBook, patchBook, putBook } from \"../services/admin\";\nimport { Book, useBooks } from \"../services/book\";\nimport { useCart } from \"../services/cart\";\nimport { DisplayCol, ManagementView } from \"./ManagementView\";\n\nexport function BookManagementView() {\n  const { books, revalidate } = useBooks();\n  const revalidateCart = useCart().revalidate;\n  const rows = _.values(books);\n\n  type Row = Book;\n  const cols: DisplayCol<Row>[] = ([\n    \"id\",\n    \"isbn\",\n    \"name\",\n    \"type\",\n    \"author\",\n    \"price\",\n    \"description\",\n    \"inventory\",\n    \"image\",\n  ] as (keyof Row)[]).map((k) => {\n    return { name: k, title: titleize(k) };\n  });\n\n  const [errorShow, setErrorShow] = useState(false);\n  const [errorResponse, setErrorResponse] = useState<Response>();\n\n  return (\n    <>\n      <ErrorModal modalShow={errorShow} setModalShow={setErrorShow}>\n        {errorResponse ? (\n          <>\n            <h5>{`Error occurred while processing \"${errorResponse.url}\":`}</h5>\n            <p>{`${errorResponse.status} ${errorResponse.statusText}`}</p>\n          </>\n        ) : null}\n      </ErrorModal>\n      <ManagementView\n        showAddCommand\n        showDeleteCommand\n        showEditCommand\n        rows={rows}\n        cols={cols}\n        onCommitChanges={async ({ added, changed, deleted }) => {\n          let allPromises: Promise<Response>[] = [];\n\n          if (added) {\n            const promises = _(added)\n              .map((item) => putBook(item))\n              .value();\n            allPromises.push(...promises);\n          }\n\n          if (changed) {\n            const promises = _(changed)\n              .entries()\n              .filter(([_id, patch]) => !!patch)\n              .map(([id, patch]) => patchBook(id, patch!))\n              .value();\n            allPromises.push(...promises);\n          }\n\n          if (deleted) {\n            const promises = _(deleted)\n              .map((id) => deleteBook(id.toString()))\n              .value();\n            allPromises.push(...promises);\n          }\n\n          const responses = await Promise.all(allPromises);\n          const failedOne = responses.find((r) => !r.ok);\n          setErrorResponse(failedOne);\n          setErrorShow(!!failedOne);\n\n          await Promise.all([revalidate(), revalidateCart()]);\n        }}\n      />\n    </>\n  );\n}\n","import _ from \"lodash\";\nimport { ErrorModal } from \"../components/ErrorModal\";\nimport { useState } from \"react\";\nimport { patchUser, useAllUsers } from \"../services/admin\";\nimport { UserType } from \"../services/auth\";\nimport { DisplayCol, ManagementView } from \"./ManagementView\";\n\nexport function UserManagementView() {\n  const { users, revalidate } = useAllUsers();\n\n  const rows = _.values(users).map((user) => {\n    return {\n      admin: user.type === UserType.admin,\n      ...user,\n    };\n  });\n\n  type Row = typeof rows[number];\n\n  const cols: DisplayCol<Row>[] = [\n    { name: \"id\", title: \"User ID\" },\n    { name: \"username\", title: \"Username\" },\n    { name: \"email\", title: \"Email\" },\n    { name: \"admin\", title: \"Is Admin\" },\n    { name: \"banned\", title: \"Is Banned\" },\n  ];\n\n  const [errorShow, setErrorShow] = useState(false);\n  const [errorResponse, setErrorResponse] = useState<Response>();\n\n  return (\n    <>\n      <ErrorModal modalShow={errorShow} setModalShow={setErrorShow}>\n        {errorResponse ? (\n          <>\n            <h5>{`Error occurred while processing \"${errorResponse.url}\":`}</h5>\n            <p>{`${errorResponse.status} ${errorResponse.statusText}`}</p>\n          </>\n        ) : null}\n      </ErrorModal>\n      <ManagementView\n        showEditCommand\n        rows={rows}\n        cols={cols}\n        booleanCols={[\"admin\", \"banned\"]}\n        onCommitChanges={async ({ changed }) => {\n          let allPromises: Promise<Response>[] = [];\n\n          if (changed) {\n            const promises = _(changed)\n              .entries()\n              .filter(([_id, patch]) => !!patch)\n              .map(([id, patch]) => {\n                const data = {\n                  type:\n                    patch!.admin !== undefined\n                      ? (patch!.admin as boolean)\n                        ? UserType.admin\n                        : UserType.normal\n                      : undefined,\n                  ...patch,\n                };\n                return patchUser(id, data);\n              })\n              .value();\n            allPromises.push(...promises);\n          }\n\n          const responses = await Promise.all(allPromises);\n          const failedOne = responses.find((r) => !r.ok);\n          setErrorResponse(failedOne);\n          setErrorShow(!!failedOne);\n\n          await revalidate();\n        }}\n      />\n    </>\n  );\n}\n","import moment from \"moment\";\n\nexport function DatetimeFormatter({ value }: { value: string }) {\n  const datetime = moment(value);\n  return <>{datetime.format(\"YYYY-MM-DD HH:mm:ss\")}</>;\n}\n","import { Row } from \"react-bootstrap\";\nimport { Link } from \"react-router-dom\";\nimport { Order } from \"../services/order\";\nimport {\n  PagingState,\n  IntegratedPaging,\n  IntegratedFiltering,\n  SortingState,\n  IntegratedSorting,\n  DataTypeProvider,\n  FilteringState,\n  GridColumnExtension,\n} from \"@devexpress/dx-react-grid\";\nimport {\n  Grid,\n  Table,\n  TableHeaderRow,\n  PagingPanel,\n  TableColumnResizing,\n  TableFilterRow,\n} from \"@devexpress/dx-react-grid-bootstrap4\";\nimport { DisplayCol } from \"../views/ManagementView\";\nimport { PropsWithChildren } from \"react\";\nimport { GridSortLabel } from \"../components/GridSortLabel\";\nimport moment from \"moment\";\nimport { DatetimeFormatter } from \"../components/formatters\";\n\nexport function OrdersView({\n  orders,\n  showUser = false,\n}: PropsWithChildren<{\n  orders: Order[];\n  showUser?: boolean;\n}>) {\n  const rows = orders.map((o) => {\n    return {\n      userShow: `${o.user?.username} [${o.user?.id}]`,\n      ...o,\n    };\n  });\n\n  type Items = Order[\"items\"];\n  type Row = typeof rows[number];\n\n  const cols: DisplayCol<Row>[] = [\n    { name: \"id\", title: \"Order ID\" },\n    { name: \"createdAt\", title: \"Created At\" },\n    { name: \"items\", title: \"Items\" },\n    { name: \"totalPrice\", title: \"Total\" },\n    { name: \"consignee\", title: \"Consignee\" },\n    { name: \"status\", title: \"Status\" },\n  ];\n\n  if (showUser) {\n    cols.splice(1, 0, { name: \"userShow\", title: \"User\" });\n  }\n\n  const widths = [\n    { columnName: \"id\", width: 120 },\n    { columnName: \"userShow\", width: 150 },\n    { columnName: \"createdAt\", width: 280 },\n    { columnName: \"items\", width: 350 },\n    { columnName: \"totalPrice\", width: 100 },\n    { columnName: \"consignee\", width: 150 },\n    { columnName: \"status\", width: 100 },\n  ];\n\n  const OrderItemFormatter = ({ value }: { value: Items }) => {\n    const items = value.map(({ book, quantity }) => (\n      <Row key={book.id}>\n        <Link to={`/detail/${book.id}`} className=\"d-flex nav-link\">\n          <span className=\"me-auto\">{book.name}</span>\n          <span className=\"text-muted\">x{quantity}</span>\n        </Link>\n      </Row>\n    ));\n    return <>{items}</>;\n  };\n\n  const filtering: GridColumnExtension[] = [\n    {\n      columnName: \"createdAt\",\n      predicate: (value: string, filter) => {\n        if (!filter.value) return true;\n        const dates = filter.value.split(/,|~/).map((s) => s.trim());\n        const curr = moment(value);\n        if (dates.length === 1) {\n          return curr.isSameOrAfter(dates[0]);\n        } else {\n          return curr.isSameOrAfter(dates[0]) && curr.isBefore(dates[1]);\n        }\n      },\n    },\n    {\n      columnName: \"items\",\n      predicate: (value: Items, filter) => {\n        if (!filter.value) return true;\n        const found =\n          value\n            .map((v) => v.book.name)\n            .filter((n) => n.indexOf(filter.value!) >= 0).length > 0;\n        return found;\n      },\n    },\n  ];\n\n  return (\n    <div className=\"card\">\n      <Grid rows={rows} columns={cols} getRowId={(row) => row.id}>\n        <FilteringState />\n        <IntegratedFiltering columnExtensions={filtering} />\n        <PagingState defaultCurrentPage={0} pageSize={20} />\n        <IntegratedPaging />\n        <SortingState\n          defaultSorting={[{ columnName: \"id\", direction: \"asc\" }]}\n        />\n        <IntegratedSorting />\n        <DataTypeProvider\n          formatterComponent={OrderItemFormatter}\n          for={[\"items\"]}\n        />\n        <DataTypeProvider\n          formatterComponent={DatetimeFormatter}\n          for={[\"createdAt\"]}\n        />\n        <Table />\n        <TableColumnResizing defaultColumnWidths={widths} />\n        <TableHeaderRow\n          showSortingControls\n          sortLabelComponent={GridSortLabel}\n        />\n        <TableFilterRow />\n        <PagingPanel />\n      </Grid>\n    </div>\n  );\n}\n","import { useAllOrders } from \"../services/admin\";\nimport { OrdersView } from \"./OrdersView\";\n\nexport function OrderManagementView() {\n  const { orders } = useAllOrders();\n  return <OrdersView orders={orders} showUser />;\n}\n","import { Moment } from \"moment\";\nimport { useFetch } from \".\";\nimport { encodeParams } from \"../utils\";\nimport { User } from \"./admin\";\nimport { Book } from \"./book\";\n\nexport enum OrderStatus {\n  submitted = \"submitted\",\n  shipped = \"shipped\",\n  delivered = \"delivered\",\n  cancelled = \"cancelled\",\n}\n\nexport type Order = {\n  id: string;\n  user?: User;\n  createdAt: string;\n  consignee: string;\n  status: OrderStatus;\n  items: {\n    book: Book;\n    quantity: number;\n  }[];\n  totalPrice: number;\n};\n\nexport function useOrders() {\n  const r = useFetch<Order[]>(\"/orders/\");\n  return {\n    orders: (r.error ? undefined : r.data) ?? [],\n    ...r,\n  };\n}\n\nexport type OrdersSummary = {\n  books: {\n    book: Book;\n    count: number;\n  }[];\n  total: number;\n};\n\nexport function useOrdersSummary(\n  from: Moment | undefined,\n  to: Moment | undefined\n) {\n  const r = useFetch<OrdersSummary>(\n    \"/stat/summary?\" +\n      encodeParams({\n        from: from?.toISOString(),\n        to: to?.toISOString(),\n      })\n  );\n  return {\n    summary: r.error ? undefined : r.data,\n    ...r,\n  };\n}\n","import moment, { Moment } from \"moment\";\nimport { PropsWithChildren, useState } from \"react\";\nimport ReactDatePicker from \"react-datepicker\";\n\nimport \"react-datepicker/dist/react-datepicker.css\";\nimport \"./date-picker.css\";\n\nexport function DatePicker({\n  initial,\n  onChange,\n}: PropsWithChildren<{\n  initial: Moment;\n  onChange: (newDate: Moment) => void;\n}>) {\n  const [shownDate, setShownDate] = useState<Moment>(initial);\n\n  return (\n    <ReactDatePicker\n      selected={shownDate.toDate()}\n      onChange={(newDate) => {\n        setShownDate(moment(newDate?.toString()));\n        onChange(moment(newDate?.toString()));\n      }}\n      showTimeInput\n      showTimeSelect\n      dateFormat=\"Pp\"\n    />\n  );\n}\n","import { Moment } from \"moment\";\nimport { PropsWithChildren, useEffect, useRef } from \"react\";\nimport { Row, Col, Form } from \"react-bootstrap\";\nimport { defaultFrom, defaultTo } from \"../utils\";\nimport { DatePicker } from \"./DatePicker\";\n\nexport function FromToPicker({\n  onChange,\n}: PropsWithChildren<{\n  onChange: ({ from, to }: { from: Moment; to: Moment }) => void;\n}>) {\n  const from = useRef<Moment>(defaultFrom());\n  const to = useRef<Moment>(defaultTo());\n  const notify = () => onChange({ from: from.current, to: to.current });\n\n  useEffect(() => {\n    notify();\n  });\n\n  return (\n    <Form className=\"mx-4 my-4\">\n      <Form.Group as={Row} className=\"mb-2\" controlId=\"formFrom\">\n        <Form.Label column md=\"1\" xs=\"2\">\n          From\n        </Form.Label>\n        <Col lg=\"3\" sm=\"7\" xs=\"10\">\n          <DatePicker\n            initial={from.current}\n            onChange={(newFrom) => {\n              from.current = newFrom;\n              notify();\n            }}\n          />\n        </Col>\n      </Form.Group>\n      <Form.Group as={Row} className=\"mb-2\" controlId=\"formTo\">\n        <Form.Label column md=\"1\" xs=\"2\">\n          To\n        </Form.Label>\n        <Col lg=\"3\" sm=\"7\" xs=\"10\">\n          <DatePicker\n            initial={to.current}\n            onChange={(newTo) => {\n              to.current = newTo;\n              notify();\n            }}\n          />\n        </Col>\n      </Form.Group>\n    </Form>\n  );\n}\n","import ECharts from \"echarts-for-react\";\nimport _ from \"lodash\";\nimport { Moment } from \"moment\";\nimport { useState } from \"react\";\nimport { useHistory } from \"react-router\";\nimport { FromToPicker } from \"../components/FromToPicker\";\nimport { useSales } from \"../services/admin\";\nimport { defaultFrom, defaultTo } from \"../utils\";\n\nexport function SalesView() {\n  const [from, setFrom] = useState<Moment>(defaultFrom());\n  const [to, setTo] = useState<Moment>(defaultTo());\n  const { sales } = useSales(from, to);\n  const history = useHistory();\n\n  const books = sales?.map(({ book }) => book) ?? [];\n  const counts = sales?.map(({ count }) => count) ?? [];\n\n  const option = {\n    title: {\n      text: `Sales Summary`,\n    },\n    tooltip: {\n      trigger: \"axis\",\n      axisPointer: {\n        type: \"shadow\",\n      },\n    },\n    grid: {\n      left: \"3%\",\n      right: \"4%\",\n      bottom: \"3%\",\n      containLabel: true,\n    },\n    xAxis: {\n      type: \"value\",\n    },\n    yAxis: {\n      type: \"category\",\n      data: books.map((b) => b.name).reverse(),\n    },\n    series: [\n      {\n        type: \"bar\",\n        data: counts.reverse(),\n      },\n    ],\n  };\n\n  return (\n    <>\n      <FromToPicker\n        onChange={(ft) => {\n          setFrom(ft.from);\n          setTo(ft.to);\n        }}\n      />\n      <ECharts\n        style={{\n          height: books.length * 60 + 80,\n        }}\n        option={option}\n        onEvents={{\n          click: (e: any) => {\n            const name = e.name as string;\n            const book = books.find((book) => book.name === name);\n            if (book) {\n              history.push(`/detail/${book.id}`);\n            }\n          },\n        }}\n      />\n    </>\n  );\n}\n","import ECharts from \"echarts-for-react\";\nimport _ from \"lodash\";\nimport { Moment } from \"moment\";\nimport { useState } from \"react\";\nimport { FromToPicker } from \"../components/FromToPicker\";\nimport { useUserSpendings } from \"../services/admin\";\nimport { defaultFrom, defaultTo } from \"../utils\";\n\nexport function UserSpendingsView() {\n  const [from, setFrom] = useState<Moment>(defaultFrom());\n  const [to, setTo] = useState<Moment>(defaultTo());\n  const { userSpendings } = useUserSpendings(from, to);\n\n  const users = userSpendings?.map((us) => us.user) ?? [];\n  const spendings = userSpendings?.map((us) => us.spending) ?? [];\n\n  const option = {\n    title: {\n      text: `User Spendings Summary`,\n    },\n    tooltip: {\n      trigger: \"axis\",\n      axisPointer: {\n        type: \"shadow\",\n      },\n    },\n    grid: {\n      left: \"3%\",\n      right: \"4%\",\n      bottom: \"3%\",\n      containLabel: true,\n    },\n    xAxis: {\n      type: \"value\",\n    },\n    yAxis: {\n      type: \"category\",\n      data: users.map((u) => `${u.username} [${u.id}]`).reverse(),\n    },\n    series: [\n      {\n        type: \"bar\",\n        data: spendings.reverse(),\n      },\n    ],\n    responsive: true,\n  };\n\n  return (\n    <>\n      <FromToPicker\n        onChange={(ft) => {\n          setFrom(ft.from);\n          setTo(ft.to);\n        }}\n      />\n      <ECharts\n        style={{\n          height: users.length * 60 + 80,\n        }}\n        option={option}\n      />\n    </>\n  );\n}\n","import { Header } from \"../components/Header\";\nimport { Main } from \"./common/Main\";\nimport { Body } from \"./common/Body\";\nimport { BookManagementView } from \"../views/BookManagementView\";\nimport { UserManagementView } from \"../views/UserManagementView\";\nimport { OrderManagementView } from \"../views/OrderManagementView\";\nimport { Tab, Tabs } from \"react-bootstrap\";\nimport { useRouteMatch } from \"react-router\";\nimport { DashboardPageParams } from \"../routes\";\nimport { useHistory } from \"react-router-dom\";\nimport { SalesView } from \"../views/SalesView\";\nimport { UserSpendingsView } from \"../views/UserSpendingsView\";\n\nexport function DashboardPage() {\n  return (\n    <Body>\n      <Header active=\"dashboard\" />\n      <Main>\n        <DashboardMain />\n      </Main>\n    </Body>\n  );\n}\n\nfunction DashboardMain() {\n  const tab = useRouteMatch<DashboardPageParams>().params.tab ?? \"books\";\n  const history = useHistory();\n\n  return (\n    <div>\n      <div className=\"h1 mb-4\">Dashboard</div>\n      <Tabs\n        activeKey={tab}\n        onSelect={(k) => {\n          const tab = k ?? \"books\";\n          history.replace(`/dashboard/${tab}`);\n        }}\n        className=\"mb-3\"\n      >\n        <Tab eventKey=\"books\" title=\"Books\">\n          <BookManagementView />\n        </Tab>\n        <Tab eventKey=\"users\" title=\"Users\">\n          <UserManagementView />\n        </Tab>\n        <Tab eventKey=\"orders\" title=\"Orders\">\n          <OrderManagementView />\n        </Tab>\n        <Tab eventKey=\"sales\" title=\"Sales\">\n          <SalesView />\n        </Tab>\n        <Tab eventKey=\"spendings\" title=\"User Spendings\">\n          <UserSpendingsView />\n        </Tab>\n      </Tabs>\n    </div>\n  );\n}\n","import { useHistory } from \"react-router-dom\";\nimport { useStore } from \"../services/StoreContext\";\nimport { Form } from \"react-bootstrap\";\nimport { LoginRegView } from \"../views/LoginRegView\";\nimport { useForm } from \"react-hook-form\";\nimport { useState } from \"react\";\nimport { postRegister, RegisterData } from \"../services/auth\";\nimport { useAuth } from \"../services/auth\";\n\nexport type RegisterFormData = RegisterData & {\n  confirmPassword: string;\n};\n\nexport function RegisterPage() {\n  const { setSignedOut } = useStore();\n  const { revalidate } = useAuth();\n  const history = useHistory();\n  const [processing, setProcessing] = useState(false);\n  const [wrong, setWrong] = useState(false);\n\n  const {\n    register,\n    handleSubmit,\n    watch,\n    formState: { errors },\n  } = useForm<RegisterFormData>();\n\n  const passwordValue = watch(\"password\");\n\n  return (\n    <>\n      <LoginRegView\n        isSignIn={false}\n        onSubmit={handleSubmit(async (data) => {\n          setProcessing(true);\n          const res = await postRegister({\n            username: data.username,\n            email: data.email,\n            password: data.password,\n          });\n          await revalidate();\n          setProcessing(false);\n          if (res.ok) {\n            setSignedOut(false);\n            history.push(\"/home\");\n          } else {\n            setWrong(true);\n          }\n        })}\n        isProcessing={processing}\n      >\n        <Form.Control\n          className=\"input-first\"\n          placeholder=\"Username\"\n          autoComplete=\"username\"\n          required\n          isInvalid={wrong}\n          {...register(\"username\")}\n        ></Form.Control>\n        <Form.Control\n          className=\"input-mid\"\n          placeholder=\"Email\"\n          autoComplete=\"email\"\n          required\n          isInvalid={!!errors.email}\n          {...register(\"email\", {\n            pattern: {\n              value: /^[A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,}$/i,\n              message: \"Please provide a valid email address.\",\n            },\n          })}\n        ></Form.Control>\n        <Form.Control.Feedback type=\"invalid\">\n          {errors.email?.message}\n        </Form.Control.Feedback>\n\n        <Form.Control\n          className=\"input-mid\"\n          placeholder=\"Password\"\n          type=\"password\"\n          autoComplete=\"new-password\"\n          required\n          isInvalid={!!errors.password}\n          {...register(\"password\", {\n            minLength: {\n              value: 4,\n              message: \"Password must have at least 4 characters.\",\n            },\n          })}\n        ></Form.Control>\n        <Form.Control.Feedback type=\"invalid\">\n          {errors.password?.message}\n        </Form.Control.Feedback>\n\n        <Form.Control\n          className=\"input-last\"\n          placeholder=\"Confirm Password\"\n          type=\"password\"\n          autoComplete=\"new-password\"\n          required\n          isInvalid={!!errors.confirmPassword}\n          {...register(\"confirmPassword\", {\n            validate: (value) =>\n              value === passwordValue || \"The passwords do not match.\",\n          })}\n        ></Form.Control>\n        <Form.Control.Feedback type=\"invalid\">\n          {errors.confirmPassword?.message}\n        </Form.Control.Feedback>\n\n        {wrong ? (\n          <Form.Control.Feedback type=\"invalid\">\n            Please try again.\n          </Form.Control.Feedback>\n        ) : null}\n\n        <Form.Check\n          type=\"checkbox\"\n          className=\"mt-3\"\n          label=\"Agree to terms and privacy policy\"\n          id=\"accept-privacy-policy\"\n          defaultChecked\n        />\n      </LoginRegView>\n    </>\n  );\n}\n","import ECharts from \"echarts-for-react\";\nimport _ from \"lodash\";\nimport { Moment } from \"moment\";\nimport { useState } from \"react\";\nimport { useHistory } from \"react-router\";\nimport { FromToPicker } from \"../components/FromToPicker\";\nimport { useOrdersSummary } from \"../services/order\";\nimport { defaultFrom, defaultTo } from \"../utils\";\n\nexport function OrdersSummaryView() {\n  const [from, setFrom] = useState<Moment>(defaultFrom());\n  const [to, setTo] = useState<Moment>(defaultTo());\n  const { summary } = useOrdersSummary(from, to);\n  const history = useHistory();\n\n  const books = summary?.books ?? [];\n  const totalCount = _(books)\n    .map(({ count }) => count)\n    .sum();\n  const totalPrice = summary?.total ?? 0;\n\n  const option = {\n    title: {\n      text: `${totalCount} books, ¥${totalPrice} in total`,\n    },\n    tooltip: {\n      trigger: \"axis\",\n      axisPointer: {\n        type: \"shadow\",\n      },\n    },\n    grid: {\n      left: \"3%\",\n      right: \"4%\",\n      bottom: \"3%\",\n      containLabel: true,\n    },\n    xAxis: {\n      type: \"value\",\n    },\n    yAxis: {\n      type: \"category\",\n      data: books.map(({ book }) => book.name).reverse(),\n    },\n    series: [\n      {\n        type: \"bar\",\n        data: books.map(({ count }) => count).reverse(),\n      },\n    ],\n  };\n\n  return (\n    <>\n      <FromToPicker\n        onChange={(ft) => {\n          setFrom(ft.from);\n          setTo(ft.to);\n        }}\n      />\n      <ECharts\n        style={{\n          height: books.length * 60 + 80,\n        }}\n        option={option}\n        onEvents={{\n          click: (e: any) => {\n            const name = e.name as string;\n            const book = books.find(({ book }) => book.name === name)?.book;\n            if (book) {\n              history.push(`/detail/${book.id}`);\n            }\n          },\n        }}\n      />\n    </>\n  );\n}\n","import { Header } from \"../components/Header\";\nimport { useOrders } from \"../services/order\";\nimport { Body } from \"./common/Body\";\nimport { Main } from \"./common/Main\";\nimport { OrdersView } from \"../views/OrdersView\";\nimport { Tab, Tabs } from \"react-bootstrap\";\nimport { OrdersPageParams } from \"../routes\";\nimport { useHistory, useRouteMatch } from \"react-router-dom\";\nimport { OrdersSummaryView } from \"../views/OrdersSummaryView\";\n\nexport function OrdersPage() {\n  return (\n    <Body>\n      <Header active=\"orders\" />\n      <Main>\n        <OrdersMain />\n      </Main>\n    </Body>\n  );\n}\n\nfunction OrdersMain() {\n  const tab = useRouteMatch<OrdersPageParams>().params.tab ?? \"all\";\n  const history = useHistory();\n\n  return (\n    <>\n      <div className=\"h1 mb-4\">My Orders</div>\n      <Tabs\n        activeKey={tab}\n        onSelect={(k) => {\n          const tab = k ?? \"books\";\n          history.replace(`/orders/${tab}`);\n        }}\n        className=\"mb-3\"\n      >\n        <Tab eventKey=\"all\" title=\"All Orders\">\n          <AllOrdersView />\n        </Tab>\n        <Tab eventKey=\"summary\" title=\"Summary\">\n          <OrdersSummaryView />\n        </Tab>\n      </Tabs>\n    </>\n  );\n}\n\nfunction AllOrdersView() {\n  const { orders } = useOrders();\n  return <OrdersView orders={orders} />;\n}\n","import { PropsWithChildren } from \"react\";\nimport {\n  Route,\n  Switch,\n  HashRouter as Router,\n  Redirect,\n  RouteProps,\n} from \"react-router-dom\";\nimport {\n  CheckoutPage,\n  DetailPage,\n  HomePage,\n  SearchPage,\n  DashboardPage,\n  LoginPage,\n  RegisterPage,\n  OrdersPage,\n} from \"./pages\";\nimport { useAuth } from \"./services/auth\";\n\nfunction SignedInRoute(props: PropsWithChildren<RouteProps>) {\n  const { error } = useAuth();\n  if (error) {\n    return <Redirect to=\"/login\" />;\n  } else {\n    return <Route {...props}>{props.children}</Route>;\n  }\n}\n\nfunction AdminRoute(props: PropsWithChildren<RouteProps>) {\n  const { isAdmin, error } = useAuth();\n  if (error || isAdmin === false) {\n    return <Redirect to=\"/home\" />;\n  } else {\n    return <Route {...props}>{props.children}</Route>;\n  }\n}\n\nexport function BSRoutes() {\n  return (\n    <Router>\n      <Switch>\n        <Route exact path=\"/\">\n          <Redirect to=\"/home\" />\n        </Route>\n        <Route path=\"/login\" component={LoginPage} />\n        <Route path=\"/register\" component={RegisterPage} />\n        <SignedInRoute path=\"/checkout\" component={CheckoutPage} />\n        <SignedInRoute path=\"/detail/:id\" component={DetailPage} />\n        <SignedInRoute path=\"/home\" component={HomePage} />\n        <SignedInRoute path=\"/search/:keyword?\" component={SearchPage} />\n        <SignedInRoute path=\"/orders/:tab?\" component={OrdersPage} />\n        <AdminRoute path=\"/dashboard/:tab?\" component={DashboardPage} />\n      </Switch>\n    </Router>\n  );\n}\n\nexport type DetailPageParams = {\n  id: string;\n};\n\nexport type SearchPageParams = {\n  keyword?: string;\n};\n\nexport type DashboardPageParams = {\n  tab?: string;\n};\n\nexport type OrdersPageParams = {\n  tab?: string;\n};\n","import { BSRoutes } from \"./routes\";\n\nimport { StoreProvider } from \"./services/StoreContext\";\n\nfunction App() {\n  return (\n    <StoreProvider>\n      <BSRoutes />\n    </StoreProvider>\n  );\n}\n\nexport default App;\n","import { ReportHandler } from \"web-vitals\";\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import(\"web-vitals\").then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\n\nimport \"bootstrap/dist/css/bootstrap.min.css\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}